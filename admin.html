<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ğŸ”§ æ•¸æ“šç®¡ç†å¾Œå° | CHDAY169</title>
  <link rel="stylesheet" href="assets/style.css">
  <style>
    .admin-container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }
    
    .admin-section {
      background: white;
      border-radius: 15px;
      padding: 25px;
      margin: 25px 0;
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
      border: 1px solid #e9ecef;
    }
    
    .admin-section h2 {
      color: #4a6fa5;
      margin-bottom: 20px;
      padding-bottom: 10px;
      border-bottom: 2px solid #e8f1ff;
    }
    
    .admin-form {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin: 25px 0;
    }
    
    .form-group {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    
    .form-group label {
      font-weight: 600;
      color: #2c3e50;
      font-size: 0.9rem;
    }
    
    .form-group input,
    .form-group select,
    .form-group textarea {
      padding: 12px;
      border: 1px solid #dee2e6;
      border-radius: 8px;
      font-size: 1rem;
      transition: border-color 0.3s ease;
    }
    
    .form-group input:focus,
    .form-group select:focus,
    .form-group textarea:focus {
      outline: none;
      border-color: #4a6fa5;
      box-shadow: 0 0 0 3px rgba(74, 111, 165, 0.1);
    }
    
    .form-group textarea {
      min-height: 120px;
      resize: vertical;
      font-family: 'Microsoft JhengHei', Arial, sans-serif;
    }
    
    .form-actions {
      grid-column: 1 / -1;
      display: flex;
      gap: 15px;
      justify-content: flex-end;
      margin-top: 10px;
    }
    
    .source-fields {
      display: none;
      grid-column: 1 / -1;
      background: #f8f9fa;
      padding: 20px;
      border-radius: 8px;
      border: 1px solid #dee2e6;
    }
    
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin: 25px 0;
    }
    
    .stat-card {
      background: linear-gradient(135deg, #e8f1ff 0%, #f8f9fa 100%);
      padding: 25px;
      border-radius: 10px;
      text-align: center;
      box-shadow: 0 3px 10px rgba(0,0,0,0.05);
      border: 1px solid #dee2e6;
    }
    
    .stat-number {
      font-size: 2.5rem;
      font-weight: bold;
      color: #4a6fa5;
      margin-bottom: 10px;
    }
    
    .stat-label {
      color: #6c757d;
      font-size: 0.9rem;
    }
    
    .data-preview {
      max-height: 400px;
      overflow-y: auto;
      background: #f8f9fa;
      padding: 20px;
      border-radius: 8px;
      font-family: 'Consolas', 'Monaco', monospace;
      font-size: 0.85rem;
      line-height: 1.5;
      border: 1px solid #dee2e6;
      margin: 20px 0;
    }
    
    .tab-container {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
      border-bottom: 2px solid #dee2e6;
      padding-bottom: 10px;
    }
    
    .tab-btn {
      padding: 10px 20px;
      background: #f8f9fa;
      border: none;
      border-radius: 8px 8px 0 0;
      cursor: pointer;
      font-weight: 500;
      transition: all 0.3s ease;
    }
    
    .tab-btn.active {
      background: #4a6fa5;
      color: white;
    }
    
    .tab-content {
      display: none;
    }
    
    .tab-content.active {
      display: block;
    }
    
    .preview-controls {
      display: flex;
      gap: 10px;
      margin-bottom: 15px;
      flex-wrap: wrap;
    }
    
    .json-key {
      color: #d14;
    }
    
    .json-string {
      color: #0a5;
    }
    
    .json-number {
      color: #07a;
    }
    
    .json-boolean {
      color: #c9a;
    }
    
    .json-null {
      color: #999;
    }
    
    @media (max-width: 768px) {
      .admin-form {
        grid-template-columns: 1fr;
      }
      
      .form-actions {
        justify-content: stretch;
      }
      
      .form-actions button {
        flex: 1;
      }
      
      .stats-grid {
        grid-template-columns: repeat(2, 1fr);
      }
    }
    
    @media (max-width: 480px) {
      .stats-grid {
        grid-template-columns: 1fr;
      }
      
      .tab-container {
        flex-direction: column;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <header class="page-header">
      <h1>ğŸ”§ æ•¸æ“šç®¡ç†å¾Œå°</h1>
      <p class="subtitle">ç®¡ç† PDF æ•™æèˆ‡å½±ç‰‡æ¸…å–®</p>
    </header>
    
    <nav class="breadcrumb">
      <a href="index.html">é¦–é </a> &gt; <span>ç®¡ç†å¾Œå°</span>
    </nav>
    
    <main class="admin-container">
      <!-- çµ±è¨ˆå€å¡Š -->
      <div class="admin-section">
        <h2>ğŸ“Š å¹³å°çµ±è¨ˆæ•¸æ“š</h2>
        <div class="stats-grid" id="statsGrid">
          <!-- å‹•æ…‹è¼‰å…¥çµ±è¨ˆæ•¸æ“š -->
        </div>
      </div>
      
      <!-- æ¨™ç±¤é å°èˆª -->
      <div class="tab-container">
        <button class="tab-btn active" onclick="switchTab('pdf')">ğŸ“š PDF ç®¡ç†</button>
        <button class="tab-btn" onclick="switchTab('video')">ğŸ¬ å½±ç‰‡ç®¡ç†</button>
        <button class="tab-btn" onclick="switchTab('preview')">ğŸ” æ•¸æ“šé è¦½</button>
        <button class="tab-btn" onclick="switchTab('tools')">ğŸ› ï¸ å·¥å…·</button>
      </div>
      
      <!-- PDF ç®¡ç† -->
      <div id="pdfTab" class="tab-content active">
        <div class="admin-section">
          <h2>ğŸ“¥ æ·»åŠ  PDF æ•™æ</h2>
          <form id="pdfForm" class="admin-form">
            <div class="form-group">
              <label for="pdfId">æ•™æ ID *</label>
              <input type="text" id="pdfId" placeholder="ä¾‹å¦‚ï¼šchapter10" required>
            </div>
            
            <div class="form-group">
              <label for="pdfTitle">æ•™ææ¨™é¡Œ *</label>
              <input type="text" id="pdfTitle" placeholder="ä¾‹å¦‚ï¼šç¬¬10ç« ï¼šé€²éšå°ˆé¡Œ" required>
            </div>
            
            <div class="form-group">
              <label for="pdfLevel">é›£åº¦ç­‰ç´š</label>
              <select id="pdfLevel">
                <option value="beginner">åˆéšå…¥é–€</option>
                <option value="intermediate">ä¸­éšæ‡‰ç”¨</option>
                <option value="advanced">é€²éšæŠ€å·§</option>
                <option value="project">å°ˆé¡Œå¯¦ä½œ</option>
              </select>
            </div>
            
            <div class="form-group">
              <label for="pdfSource">ä¾†æºé¡å‹ *</label>
              <select id="pdfSource" onchange="toggleSourceFields()">
                <option value="local">æœ¬åœ°ä¸Šå‚³</option>
                <option value="github">GitHub Release</option>
                <option value="external">å¤–éƒ¨é€£çµ</option>
              </select>
            </div>
            
            <div class="form-group">
              <label for="pdfUrl">PDF ç¶²å€ *</label>
              <input type="url" id="pdfUrl" placeholder="https://..." required>
            </div>
            
            <!-- GitHub ç‰¹å®šæ¬„ä½ -->
            <div id="githubFields" class="source-fields">
              <div class="form-group">
                <label for="githubRepo">GitHub å€‰åº«</label>
                <input type="text" id="githubRepo" placeholder="username/repo">
              </div>
              
              <div class="form-group">
                <label for="releaseTag">Release æ¨™ç±¤</label>
                <input type="text" id="releaseTag" placeholder="v1.0">
              </div>
              
              <div class="form-group">
                <label for="filename">æª”æ¡ˆåç¨±</label>
                <input type="text" id="filename" placeholder="document.pdf">
              </div>
              
              <button type="button" onclick="generateGitHubURL()" class="btn btn-sm">
                ç”Ÿæˆ GitHub URL
              </button>
            </div>
            
            <div class="form-actions">
              <button type="submit" class="btn btn-primary">æ·»åŠ  PDF</button>
              <button type="reset" class="btn btn-secondary">é‡è¨­è¡¨å–®</button>
            </div>
          </form>
        </div>
      </div>
      
      <!-- å½±ç‰‡ç®¡ç† -->
      <div id="videoTab" class="tab-content">
        <div class="admin-section">
          <h2>ğŸ“¹ æ·»åŠ æ•™å­¸å½±ç‰‡</h2>
          <form id="videoForm" class="admin-form">
            <div class="form-group">
              <label for="videoId">å½±ç‰‡ ID *</label>
              <input type="text" id="videoId" placeholder="ä¾‹å¦‚ï¼šscratch_tutorial_1" required>
            </div>
            
            <div class="form-group">
              <label for="videoTitle">å½±ç‰‡æ¨™é¡Œ *</label>
              <input type="text" id="videoTitle" placeholder="ä¾‹å¦‚ï¼šScratchå‹•ç•«æ•™å­¸" required>
            </div>
            
            <div class="form-group">
              <label for="videoDescription">å½±ç‰‡èªªæ˜</label>
              <textarea id="videoDescription" placeholder="å½±ç‰‡ç°¡ä»‹..."></textarea>
            </div>
            
            <div class="form-group">
              <label for="videoSource">ä¾†æºé¡å‹ *</label>
              <select id="videoSource">
                <option value="youtube">YouTube</option>
                <option value="external">å¤–éƒ¨ç¶²ç«™</option>
                <option value="embed">ç›´æ¥åµŒå…¥</option>
              </select>
            </div>
            
            <div class="form-group">
              <label for="videoUrl">å½±ç‰‡ç¶²å€ *</label>
              <input type="url" id="videoUrl" placeholder="https://www.youtube.com/embed/..." required>
            </div>
            
            <div class="form-group">
              <label for="videoCategory">åˆ†é¡</label>
              <select id="videoCategory">
                <option value="scratch">Scratch æ•™å­¸</option>
                <option value="tutorial">ç¨‹å¼æ•™å­¸</option>
                <option value="demo">ä½œå“å±•ç¤º</option>
              </select>
            </div>
            
            <div class="form-group">
              <label for="videoChannel">é »é“/ä½œè€…</label>
              <input type="text" id="videoChannel" placeholder="ä¾‹å¦‚ï¼šchday7919">
            </div>
            
            <div class="form-group">
              <label for="videoDuration">å½±ç‰‡é•·åº¦</label>
              <input type="text" id="videoDuration" placeholder="ä¾‹å¦‚ï¼š15:30">
            </div>
            
            <div class="form-group">
              <label for="videoThumbnail">ç¸®åœ–ç¶²å€</label>
              <input type="url" id="videoThumbnail" placeholder="https://img.youtube.com/vi/.../0.jpg">
            </div>
            
            <div class="form-actions">
              <button type="submit" class="btn btn-primary">æ·»åŠ å½±ç‰‡</button>
              <button type="reset" class="btn btn-secondary">é‡è¨­è¡¨å–®</button>
            </div>
          </form>
        </div>
      </div>
      
      <!-- æ•¸æ“šé è¦½ -->
      <div id="previewTab" class="tab-content">
        <div class="admin-section">
          <h2>ğŸ” æ•¸æ“šé è¦½èˆ‡æª¢æŸ¥</h2>
          
          <div class="preview-controls">
            <button onclick="loadPreview('pdf')" class="btn">ğŸ“š é è¦½ PDF æ¸…å–®</button>
            <button onclick="loadPreview('video')" class="btn">ğŸ¬ é è¦½å½±ç‰‡æ¸…å–®</button>
            <button onclick="checkIntegrity()" class="btn btn-secondary">âœ… æª¢æŸ¥å®Œæ•´æ€§</button>
            <button onclick="exportData()" class="btn" style="background: #28a745; color: white;">ğŸ“¥ åŒ¯å‡ºæ•¸æ“š</button>
          </div>
          
          <div id="previewArea" class="data-preview">
            è«‹é¸æ“‡ä¸Šæ–¹æŒ‰éˆ•é è¦½æ•¸æ“š
          </div>
        </div>
      </div>
      
      <!-- å·¥å…· -->
      <div id="toolsTab" class="tab-content">
        <div class="admin-section">
          <h2>ğŸ› ï¸ ç³»çµ±å·¥å…·</h2>
          
          <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin: 25px 0;">
            <div style="text-align: center; padding: 25px; background: #f8f9fa; border-radius: 10px;">
              <div style="font-size: 2.5rem; margin-bottom: 15px;">ğŸ”„</div>
              <h4 style="color: #4a6fa5; margin-bottom: 10px;">é‡æ–°æ•´ç†å¿«å–</h4>
              <p style="color: #6c757d; font-size: 0.9rem; margin-bottom: 15px;">æ¸…é™¤ç€è¦½å™¨å¿«å–ï¼Œè¼‰å…¥æœ€æ–°æ•¸æ“š</p>
              <button onclick="clearCache()" class="btn btn-sm">æ¸…é™¤å¿«å–</button>
            </div>
            
            <div style="text-align: center; padding: 25px; background: #f8f9fa; border-radius: 10px;">
              <div style="font-size: 2.5rem; margin-bottom: 15px;">ğŸ“Š</div>
              <h4 style="color: #4a6fa5; margin-bottom: 10px;">é‡ç½®çµ±è¨ˆæ•¸æ“š</h4>
              <p style="color: #6c757d; font-size: 0.9rem; margin-bottom: 15px;">æ¸…é™¤æ‰€æœ‰ç€è¦½å’Œé»è®šçµ±è¨ˆ</p>
              <button onclick="resetStatistics()" class="btn btn-sm" style="background: #dc3545; color: white;">é‡ç½®çµ±è¨ˆ</button>
            </div>
            
            <div style="text-align: center; padding: 25px; background: #f8f9fa; border-radius: 10px;">
              <div style="font-size: 2.5rem; margin-bottom: 15px;">ğŸ”§</div>
              <h4 style="color: #4a6fa5; margin-bottom: 10px;">ç³»çµ±è³‡è¨Š</h4>
              <p style="color: #6c757d; font-size: 0.9rem; margin-bottom: 15px;">æŸ¥çœ‹å¹³å°é‹è¡Œç‹€æ…‹å’Œç‰ˆæœ¬è³‡è¨Š</p>
              <button onclick="showSystemInfo()" class="btn btn-sm">ç³»çµ±è³‡è¨Š</button>
            </div>
          </div>
          
          <div id="toolsResult" style="margin-top: 20px;"></div>
        </div>
      </div>
    </main>
    
    <footer style="text-align: center; margin-top: 4rem; padding-top: 2rem; border-top: 1px solid #dee2e6;">
      <div class="btn-container">
        <a href="index.html" class="btn btn-sm">ğŸ  è¿”å›é¦–é </a>
        <a href="scratch-viewer.html" class="btn btn-sm btn-secondary">ğŸ“š PDF æ•™æ</a>
        <a href="video-player.html" class="btn btn-sm btn-secondary">ğŸ¬ æ•™å­¸å½±ç‰‡</a>
      </div>
      <p style="margin-top: 20px;">&copy; 2025 CHDAY169 Scratch æ•™å­¸å¹³å° | ç®¡ç†å¾Œå° v1.0</p>
    </footer>
  </div>
  
  <script src="assets/script/data-manager.js"></script>
  <script>
    const dataManager = new DataManager();
    
    // åˆ‡æ›æ¨™ç±¤é 
    function switchTab(tabName) {
      // éš±è—æ‰€æœ‰æ¨™ç±¤å…§å®¹
      document.querySelectorAll('.tab-content').forEach(tab => {
        tab.classList.remove('active');
      });
      
      // ç§»é™¤æ‰€æœ‰æ¨™ç±¤æŒ‰éˆ•çš„ active é¡åˆ¥
      document.querySelectorAll('.tab-btn').forEach(btn => {
        btn.classList.remove('active');
      });
      
      // é¡¯ç¤ºé¸ä¸­çš„æ¨™ç±¤å…§å®¹
      document.getElementById(tabName + 'Tab').classList.add('active');
      
      // ç‚ºé¸ä¸­çš„æ¨™ç±¤æŒ‰éˆ•æ·»åŠ  active é¡åˆ¥
      event.target.classList.add('active');
      
      // å¦‚æœæ˜¯é è¦½æ¨™ç±¤ï¼Œè¼‰å…¥é è¨­é è¦½
      if (tabName === 'preview') {
        loadPreview('pdf');
      }
    }
    
    // è¼‰å…¥çµ±è¨ˆæ•¸æ“š
    async function loadStatistics() {
      const stats = dataManager.getStatistics();
      const integrity = await dataManager.checkDataIntegrity();
      
      document.getElementById('statsGrid').innerHTML = `
        <div class="stat-card">
          <div class="stat-number">${stats.totalPDFViews || 0}</div>
          <div class="stat-label">PDF ç€è¦½æ¬¡æ•¸</div>
        </div>
        <div class="stat-card">
          <div class="stat-number">${stats.totalVideoViews || 0}</div>
          <div class="stat-label">å½±ç‰‡ç€è¦½æ¬¡æ•¸</div>
        </div>
        <div class="stat-card">
          <div class="stat-number">${stats.overallTotal || 0}</div>
          <div class="stat-label">ç¸½ç€è¦½æ¬¡æ•¸</div>
        </div>
        <div class="stat-card">
          <div class="stat-number">${integrity?.pdfs?.count || 0}</div>
          <div class="stat-label">PDF æ•™ææ•¸</div>
        </div>
        <div class="stat-card">
          <div class="stat-number">${integrity?.videos?.count || 0}</div>
          <div class="stat-label">å½±ç‰‡æ•¸é‡</div>
        </div>
        <div class="stat-card">
          <div class="stat-number">${integrity?.pdfs?.valid && integrity?.videos?.valid ? 'âœ…' : 'âš ï¸'}</div>
          <div class="stat-label">æ•¸æ“šå®Œæ•´æ€§</div>
        </div>
      `;
    }
    
    // åˆ‡æ›ä¾†æºæ¬„ä½é¡¯ç¤º
    function toggleSourceFields() {
      const source = document.getElementById('pdfSource').value;
      const githubFields = document.getElementById('githubFields');
      
      if (source === 'github') {
        githubFields.style.display = 'grid';
      } else {
        githubFields.style.display = 'none';
      }
    }
    
    // ç”Ÿæˆ GitHub URL
    function generateGitHubURL() {
      const repo = document.getElementById('githubRepo').value;
      const tag = document.getElementById('releaseTag').value;
      const filename = document.getElementById('filename').value;
      
      if (repo && tag && filename) {
        const url = dataManager.generateGitHubURL(repo, tag, filename);
        document.getElementById('pdfUrl').value = url;
        showMessage(`GitHub URL å·²ç”Ÿæˆï¼š${url}`, 'success');
      } else {
        showMessage('è«‹å¡«å¯«æ‰€æœ‰ GitHub ç›¸é—œæ¬„ä½', 'error');
      }
    }
    
    // PDF è¡¨å–®æäº¤
    document.getElementById('pdfForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      
      const pdfData = {
        id: document.getElementById('pdfId').value,
        title: document.getElementById('pdfTitle').value,
        level: document.getElementById('pdfLevel').value,
        source: document.getElementById('pdfSource').value,
        url: document.getElementById('pdfUrl').value
      };
      
      if (pdfData.source === 'github') {
        pdfData.github_repo = document.getElementById('githubRepo').value;
        pdfData.release_tag = document.getElementById('releaseTag').value;
      }
      
      const success = await dataManager.addPDF(pdfData);
      if (success) {
        showMessage('PDF å·²æˆåŠŸæ·»åŠ ï¼', 'success');
        this.reset();
        toggleSourceFields();
        loadPreview('pdf'); // é‡æ–°è¼‰å…¥é è¦½
      } else {
        showMessage('æ·»åŠ å¤±æ•—ï¼Œè«‹æª¢æŸ¥æ§åˆ¶å°éŒ¯èª¤è¨Šæ¯', 'error');
      }
    });
    
    // å½±ç‰‡è¡¨å–®æäº¤
    document.getElementById('videoForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      
      const videoData = {
        id: document.getElementById('videoId').value,
        title: document.getElementById('videoTitle').value,
        description: document.getElementById('videoDescription').value,
        source: document.getElementById('videoSource').value,
        url: document.getElementById('videoUrl').value,
        category: document.getElementById('videoCategory').value,
        channel: document.getElementById('videoChannel').value,
        duration: document.getElementById('videoDuration').value,
        thumbnail: document.getElementById('videoThumbnail').value,
        published: new Date().toISOString().split('T')[0],
        status: 'ready'
      };
      
      const success = await dataManager.addVideo(videoData);
      if (success) {
        showMessage('å½±ç‰‡å·²æˆåŠŸæ·»åŠ ï¼', 'success');
        this.reset();
        loadPreview('video'); // é‡æ–°è¼‰å…¥é è¦½
      } else {
        showMessage('æ·»åŠ å¤±æ•—ï¼Œè«‹æª¢æŸ¥æ§åˆ¶å°éŒ¯èª¤è¨Šæ¯', 'error');
      }
    });
    
    // è¼‰å…¥æ•¸æ“šé è¦½
    async function loadPreview(type) {
      try {
        const url = type === 'pdf' ? './data_scr/manifest.json' : './data_scr/video_list.json';
        const response = await fetch(url);
        const data = await response.json();
        
        // èªæ³•é«˜äº®é¡¯ç¤º
        const jsonString = JSON.stringify(data, null, 2);
        const highlighted = syntaxHighlight(jsonString);
        
        document.getElementById('previewArea').innerHTML = `
          <div style="margin-bottom: 10px; font-weight: bold;">
            ${type === 'pdf' ? 'ğŸ“š PDF æ¸…å–®' : 'ğŸ¬ å½±ç‰‡æ¸…å–®'} (${data[type === 'pdf' ? 'pdfs' : 'videos']?.length || 0} å€‹é …ç›®)
          </div>
          <pre style="margin: 0;">${highlighted}</pre>
        `;
      } catch (error) {
        document.getElementById('previewArea').innerHTML = 
          `<div style="color: #dc3545;">âŒ è¼‰å…¥å¤±æ•—ï¼š${error.message}</div>`;
      }
    }
    
    // JSON èªæ³•é«˜äº®
    function syntaxHighlight(json) {
      json = json.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
      return json.replace(/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)/g, 
        function (match) {
          let cls = 'json-number';
          if (/^"/.test(match)) {
            if (/:$/.test(match)) {
              cls = 'json-key';
            } else {
              cls = 'json-string';
            }
          } else if (/true|false/.test(match)) {
            cls = 'json-boolean';
          } else if (/null/.test(match)) {
            cls = 'json-null';
          }
          return '<span class="' + cls + '">' + match + '</span>';
        });
    }
    
    // æª¢æŸ¥æ•¸æ“šå®Œæ•´æ€§
    async function checkIntegrity() {
      const result = await dataManager.checkDataIntegrity();
      
      if (!result) {
        document.getElementById('previewArea').innerHTML = '<div style="color: #dc3545;">âŒ æª¢æŸ¥å¤±æ•—</div>';
        return;
      }
      
      let output = '<div style="font-weight: bold; margin-bottom: 15px;">ğŸ“Š æ•¸æ“šå®Œæ•´æ€§æª¢æŸ¥çµæœï¼š</div>';
      
      // PDF æª¢æŸ¥çµæœ
      output += '<div style="margin-bottom: 15px;">';
      output += '<div style="font-weight: bold; color: #4a6fa5;">ğŸ“š PDF æ•™æï¼š</div>';
      output += `<div>æ•¸é‡ï¼š${result.pdfs.count}</div>`;
      output += `<div>æœ‰æ•ˆæ€§ï¼š${result.pdfs.valid ? 'âœ… é€šé' : 'âŒ å¤±æ•—'}</div>`;
      if (result.pdfs.errors.length > 0) {
        output += `<div style="color: #dc3545; margin-top: 5px;">éŒ¯èª¤ï¼š</div>`;
        output += `<ul style="color: #dc3545; margin: 5px 0 0 20px;">`;
        result.pdfs.errors.forEach(e => {
          output += `<li>${e}</li>`;
        });
        output += '</ul>';
      }
      output += '</div>';
      
      // å½±ç‰‡æª¢æŸ¥çµæœ
      output += '<div>';
      output += '<div style="font-weight: bold; color: #4a6fa5;">ğŸ¬ å½±ç‰‡ï¼š</div>';
      output += `<div>æ•¸é‡ï¼š${result.videos.count}</div>`;
      output += `<div>æœ‰æ•ˆæ€§ï¼š${result.videos.valid ? 'âœ… é€šé' : 'âŒ å¤±æ•—'}</div>`;
      if (result.videos.errors.length > 0) {
        output += `<div style="color: #dc3545; margin-top: 5px;">éŒ¯èª¤ï¼š</div>`;
        output += `<ul style="color: #dc3545; margin: 5px 0 0 20px;">`;
        result.videos.errors.forEach(e => {
          output += `<li>${e}</li>`;
        });
        output += '</ul>';
      }
      output += '</div>';
      
      document.getElementById('previewArea').innerHTML = output;
    }
    
    // åŒ¯å‡ºæ•¸æ“š
    async function exportData() {
      try {
        const [pdfRes, videoRes] = await Promise.all([
          fetch('./data_scr/manifest.json'),
          fetch('./data_scr/video_list.json')
        ]);
        
        const pdfData = await pdfRes.json();
        const videoData = await videoRes.json();
        
        const exportData = {
          export_time: new Date().toISOString(),
          platform: 'CHDAY169 Scratch æ•™å­¸å¹³å°',
          pdfs: pdfData,
          videos: videoData,
          statistics: dataManager.getStatistics()
        };
        
        const blob = new Blob([JSON.stringify(exportData, null, 2)], {
          type: 'application/json'
        });
        
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `chday169_data_${new Date().toISOString().split('T')[0]}.json`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
        
        showMessage('æ•¸æ“šåŒ¯å‡ºæˆåŠŸï¼', 'success');
      } catch (error) {
        showMessage(`åŒ¯å‡ºå¤±æ•—ï¼š${error.message}`, 'error');
      }
    }
    
    // æ¸…é™¤å¿«å–
    function clearCache() {
      // æ¸…é™¤ç‰¹å®šçš„ localStorage é …ç›®ï¼ˆä¿ç•™çµ±è¨ˆæ•¸æ“šï¼‰
      const keysToRemove = [];
      for (let i = 0; i < localStorage.length; i++) {
        const key = localStorage.key(i);
        if (key && (key.startsWith('cache_') || key.startsWith('last_loaded_'))) {
          keysToRemove.push(key);
        }
      }
      
      keysToRemove.forEach(key => localStorage.removeItem(key));
      
      // é‡æ–°è¼‰å…¥é é¢
      showMessage('å¿«å–å·²æ¸…é™¤ï¼Œé‡æ–°è¼‰å…¥æ•¸æ“š...', 'success');
      setTimeout(() => {
        location.reload();
      }, 1500);
    }
    
    // é‡ç½®çµ±è¨ˆæ•¸æ“š
    function resetStatistics() {
      if (confirm('âš ï¸  ç¢ºå®šè¦é‡ç½®æ‰€æœ‰çµ±è¨ˆæ•¸æ“šå—ï¼Ÿæ­¤æ“ä½œç„¡æ³•å¾©åŸï¼')) {
        // ç§»é™¤æ‰€æœ‰çµ±è¨ˆç›¸é—œçš„ localStorage
        const keysToRemove = [];
        for (let i = 0; i < localStorage.length; i++) {
          const key = localStorage.key(i);
          if (key && (
            key.startsWith('views_') || 
            key.startsWith('pdf_views_') || 
            key.startsWith('video_views_') ||
            key.startsWith('total_') ||
            key === 'total_video_views'
          )) {
            keysToRemove.push(key);
          }
        }
        
        keysToRemove.forEach(key => localStorage.removeItem(key));
        
        showMessage('çµ±è¨ˆæ•¸æ“šå·²é‡ç½®ï¼', 'success');
        setTimeout(() => {
          loadStatistics();
        }, 1000);
      }
    }
    
    // é¡¯ç¤ºç³»çµ±è³‡è¨Š
    function showSystemInfo() {
      const info = {
        å¹³å°ç‰ˆæœ¬: '2.0',
        æœ€å¾Œæ›´æ–°: new Date().toLocaleDateString('zh-TW'),
        ç€è¦½å™¨: navigator.userAgent,
        èªè¨€: navigator.language,
        åœ¨ç·šç‹€æ…‹: navigator.onLine ? 'åœ¨ç·š' : 'é›¢ç·š',
        å±å¹•è§£æåº¦: `${screen.width} x ${screen.height}`,
        localStorageä½¿ç”¨é‡: `${JSON.stringify(localStorage).length} å­—ç¯€`
      };
      
      let output = '<div style="font-weight: bold; margin-bottom: 10px;">ğŸ–¥ï¸ ç³»çµ±è³‡è¨Šï¼š</div>';
      output += '<table style="width: 100%; border-collapse: collapse;">';
      for (const [key, value] of Object.entries(info)) {
        output += `
          <tr>
            <td style="padding: 8px; border-bottom: 1px solid #dee2e6; font-weight: bold;">${key}</td>
            <td style="padding: 8px; border-bottom: 1px solid #dee2e6;">${value}</td>
          </tr>
        `;
      }
      output += '</table>';
      
      document.getElementById('toolsResult').innerHTML = output;
    }
    
    // é¡¯ç¤ºè¨Šæ¯
    function showMessage(message, type) {
      const messageDiv = document.createElement('div');
      messageDiv.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        padding: 15px 25px;
        border-radius: 8px;
        color: white;
        font-weight: bold;
        z-index: 1000;
        animation: slideIn 0.3s ease;
      `;
      
      if (type === 'success') {
        messageDiv.style.background = '#28a745';
      } else if (type === 'error') {
        messageDiv.style.background = '#dc3545';
      } else {
        messageDiv.style.background = '#4a6fa5';
      }
      
      messageDiv.textContent = message;
      document.body.appendChild(messageDiv);
      
      setTimeout(() => {
        messageDiv.style.animation = 'slideOut 0.3s ease';
        setTimeout(() => {
          document.body.removeChild(messageDiv);
        }, 300);
      }, 3000);
    }
    
    // æ·»åŠ  CSS å‹•ç•«
    const style = document.createElement('style');
    style.textContent = `
      @keyframes slideIn {
        from { transform: translateX(100%); opacity: 0; }
        to { transform: translateX(0); opacity: 1; }
      }
      @keyframes slideOut {
        from { transform: translateX(0); opacity: 1; }
        to { transform: translateX(100%); opacity: 0; }
      }
    `;
    document.head.appendChild(style);
    
    // åˆå§‹åŒ–
    document.addEventListener('DOMContentLoaded', function() {
      loadStatistics();
      toggleSourceFields();
      loadPreview('pdf');
      
      // ç‚ºè¡¨å–®æ·»åŠ é˜²å‘†
      document.getElementById('pdfId').addEventListener('input', function() {
        this.value = this.value.toLowerCase().replace(/[^a-z0-9_]/g, '_');
      });
      
      document.getElementById('videoId').addEventListener('input', function() {
        this.value = this.value.toLowerCase().replace(/[^a-z0-9_]/g, '_');
      });
    });
  </script>
</body>
</html>