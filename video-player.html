<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ğŸ¥ YouTube ç²¾é¸å½±ç‰‡ | CHDAY169</title>
  <link rel="stylesheet" href="assets/style.css">
  <style>
    /* ä¿æŒåŸæœ‰çš„CSSæ¨£å¼ï¼Œåªæ–°å¢ä»¥ä¸‹æ¨£å¼ */
    .video-source-badge {
      display: inline-block;
      padding: 4px 8px;
      font-size: 0.8rem;
      border-radius: 10px;
      margin-left: 8px;
      font-weight: 500;
    }
    
    .source-youtube {
      background: #ff0000;
      color: white;
    }
    
    .source-external {
      background: #007bff;
      color: white;
    }
    
    .source-embed {
      background: #28a745;
      color: white;
    }
    
    .channel-badge {
      background: #6c757d;
      color: white;
      padding: 3px 8px;
      border-radius: 10px;
      font-size: 0.75rem;
      margin-left: 5px;
    }
    
    .video-source-filter {
      display: flex;
      gap: 10px;
      margin: 20px 0;
      padding: 15px;
      background: #f8f9fa;
      border-radius: 8px;
      flex-wrap: wrap;
    }
    
    .source-filter-btn {
      padding: 6px 12px;
      background: white;
      border: 1px solid #dee2e6;
      border-radius: 20px;
      cursor: pointer;
      font-size: 0.9rem;
      transition: all 0.3s ease;
    }
    
    .source-filter-btn.active {
      background: #4a6fa5;
      color: white;
      border-color: #4a6fa5;
    }
    
    .external-warning {
      background: #fff3cd;
      border: 1px solid #ffeaa7;
      color: #856404;
      padding: 15px;
      border-radius: 8px;
      margin: 15px 0;
      text-align: center;
    }
    
    .video-thumbnail {
      width: 100%;
      aspect-ratio: 16/9;
      background-size: cover;
      background-position: center;
      border-radius: 8px;
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 3rem;
      color: white;
      text-shadow: 0 2px 4px rgba(0,0,0,0.3);
    }
  </style>
</head>
<body class="container">
  <header class="page-header">
    <h1>ğŸ¥ å½±ç‰‡æ•™å­¸ä¸­å¿ƒ</h1>
    <p class="subtitle">Scratch ç¨‹å¼è¨­è¨ˆèˆ‡å„é¡æ•™å­¸å½±ç‰‡ç²¾é¸</p>
    
    <div class="video-source-filter">
      <strong>ğŸ¬ å½±ç‰‡ä¾†æºï¼š</strong>
      <button onclick="filterSource('all')" class="source-filter-btn active">å…¨éƒ¨ä¾†æº</button>
      <button onclick="filterSource('youtube')" class="source-filter-btn">
        YouTube <span class="video-source-badge source-youtube">YT</span>
      </button>
      <button onclick="filterSource('external')" class="source-filter-btn">
        å¤–éƒ¨ç¶²ç«™ <span class="video-source-badge source-external">EXT</span>
      </button>
      <button onclick="filterSource('embed')" class="source-filter-btn">
        ç›´æ¥åµŒå…¥ <span class="video-source-badge source-embed">EMB</span>
      </button>
    </div>
  </header>
  
  <nav class="breadcrumb">
    <a href="index.html">é¦–é </a> &gt; <span>æ•™å­¸å½±ç‰‡</span>
  </nav>
  
  <main class="video-container">
    <section class="video-player-section">
      <div class="video-title" id="video-title">è¼‰å…¥ä¸­...</div>
      
      <div id="video-container" class="video-wrapper">
        <!-- å½±ç‰‡å°‡å‹•æ…‹è¼‰å…¥åˆ°æ­¤è™• -->
      </div>
      
      <div class="video-info">
        <div class="video-counter" id="video-counter">å½±ç‰‡ 0 / 0</div>
        <div class="video-category" id="video-category">-</div>
        <div class="video-source" id="video-source">-</div>
      </div>
      
      <div class="video-description" id="video-description">
        å½±ç‰‡èªªæ˜è¼‰å…¥ä¸­...
      </div>
      
      <div class="video-controls">
        <button onclick="prevVideo()" class="video-btn" id="prev-btn" disabled>
          â¬…ï¸ ä¸Šä¸€éƒ¨å½±ç‰‡
        </button>
        <button onclick="nextVideo()" class="video-btn" id="next-btn" disabled>
          â¡ï¸ ä¸‹ä¸€éƒ¨å½±ç‰‡
        </button>
        <button onclick="toggleAutoplay()" class="video-btn" id="autoplay-btn">
          ğŸ”„ è‡ªå‹•æ’­æ”¾: é—œé–‰
        </button>
        <button onclick="openOriginal()" class="video-btn" id="original-btn" style="display: none;">
          ğŸŒ å‰å¾€ä¾†æºç¶²ç«™
        </button>
      </div>
    </section>
    
    <section class="video-playlist">
      <h3 class="playlist-title">ğŸ“‹ å½±ç‰‡æ’­æ”¾æ¸…å–®</h3>
      <div class="playlist-grid" id="playlist-grid">
        <!-- æ’­æ”¾æ¸…å–®é …ç›®æœƒç”± JavaScript å‹•æ…‹ç”Ÿæˆ -->
      </div>
    </section>
  </main>
  
  <script>
    const videoListURL = './data_scr/video_list.json';
    
    let videoList = [];
    let filteredVideos = [];
    let currentIndex = 0;
    let autoplay = false;
    let currentFilter = {
      category: 'all',
      source: 'all'
    };
    
    // è¼‰å…¥å½±ç‰‡æ¸…å–®
    async function loadVideoList() {
      try {
        showStatus('è¼‰å…¥å½±ç‰‡æ¸…å–®ä¸­...');
        
        const response = await fetch(videoListURL);
        if (!response.ok) throw new Error('ç„¡æ³•è¼‰å…¥å½±ç‰‡æ¸…å–®');
        
        const data = await response.json();
        if (!data.videos || !Array.isArray(data.videos)) {
          throw new Error('å½±ç‰‡æ¸…å–®æ ¼å¼éŒ¯èª¤');
        }
        
        videoList = data.videos;
        
        // è¼‰å…¥åˆ†é¡å’Œé »é“è³‡è¨Š
        if (data.categories) window.videoCategories = data.categories;
        if (data.channels) window.videoChannels = data.channels;
        
        // æ‡‰ç”¨éæ¿¾å™¨
        applyVideoFilters();
        
        if (videoList.length > 0) {
          showStatus(`æ‰¾åˆ° ${videoList.length} å€‹å½±ç‰‡`);
        } else {
          showStatus('âŒ æ²’æœ‰å¯ç”¨çš„å½±ç‰‡', 'error');
        }
      } catch (err) {
        console.error('è¼‰å…¥éŒ¯èª¤ï¼š', err);
        showStatus('âŒ ç„¡æ³•è¼‰å…¥å½±ç‰‡æ¸…å–®', 'error');
        loadFallbackVideos();
      }
    }
    
    function applyVideoFilters() {
      filteredVideos = videoList.filter(video => {
        // ç‹€æ…‹éæ¿¾ï¼ˆæ’é™¤ coming-soonï¼‰
        if (video.status === 'coming-soon') return false;
        
        // ä¾†æºéæ¿¾
        if (currentFilter.source !== 'all' && video.source !== currentFilter.source) {
          return false;
        }
        
        // åˆ†é¡éæ¿¾
        if (currentFilter.category !== 'all' && video.category !== currentFilter.category) {
          return false;
        }
        
        return true;
      });
      
      updatePlaylist();
      
      if (filteredVideos.length > 0) {
        loadVideo(0);
      } else {
        showNoVideosMessage();
      }
    }
    
    function filterSource(source) {
      // æ›´æ–°æŒ‰éˆ•ç‹€æ…‹
      document.querySelectorAll('.source-filter-btn').forEach(btn => {
        btn.classList.remove('active');
      });
      event.target.classList.add('active');
      
      currentFilter.source = source;
      applyVideoFilters();
    }
    
    function loadVideo(index) {
      if (index < 0 || index >= filteredVideos.length) return;
      
      currentIndex = index;
      const video = filteredVideos[index];
      
      // æ›´æ–°æ¨™é¡Œå’Œè³‡è¨Š
      document.getElementById("video-title").textContent = video.title;
      document.getElementById("video-description").textContent = video.description;
      document.getElementById("video-counter").textContent = `å½±ç‰‡ ${index + 1} / ${filteredVideos.length}`;
      document.getElementById("video-category").textContent = 
        window.videoCategories?.[video.category] || video.category || '-';
      
      // æ›´æ–°ä¾†æºé¡¯ç¤º
      const sourceEl = document.getElementById("video-source");
      let sourceText = getSourceLabel(video.source);
      if (video.channel && window.videoChannels?.[video.channel]) {
        sourceText += ` â€¢ ${window.videoChannels[video.channel]}`;
      }
      sourceEl.textContent = sourceText;
      
      // è¼‰å…¥å½±ç‰‡
      renderVideoPlayer(video);
      
      // æ›´æ–°æ§åˆ¶æŒ‰éˆ•
      updateVideoControls();
      
      // é¡¯ç¤ºå¤–éƒ¨é€£çµæŒ‰éˆ•
      const originalBtn = document.getElementById("original-btn");
      if (video.source === 'external' || video.source === 'youtube') {
        originalBtn.style.display = 'inline-block';
        originalBtn.onclick = () => window.open(video.url.replace('/embed/', '/watch?v=') || video.url, '_blank');
      } else {
        originalBtn.style.display = 'none';
      }
      
      // è¨˜éŒ„ç€è¦½
      recordVideoView(video.id);
    }
    
    function renderVideoPlayer(video) {
      const container = document.getElementById("video-container");
      container.innerHTML = '';
      
      if (video.source === 'youtube') {
        // YouTube åµŒå…¥
        const iframe = document.createElement('iframe');
        iframe.src = video.url + (autoplay ? '?autoplay=1' : '');
        iframe.allowFullscreen = true;
        iframe.allow = "accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture";
        iframe.title = video.title;
        iframe.loading = "lazy";
        container.appendChild(iframe);
        
        // æ·»åŠ  YouTube æ¨™èªŒ
        const youtubeBadge = document.createElement('div');
        youtubeBadge.innerHTML = `<span class="channel-badge">YouTube</span>`;
        container.appendChild(youtubeBadge);
        
      } else if (video.source === 'external' && video.embed_type === 'iframe') {
        // å¤–éƒ¨ iframe åµŒå…¥
        const iframe = document.createElement('iframe');
        iframe.src = video.url;
        iframe.allowFullscreen = true;
        iframe.title = video.title;
        container.appendChild(iframe);
        
        // å¤–éƒ¨ç¶²ç«™è­¦å‘Š
        const warning = document.createElement('div');
        warning.className = 'external-warning';
        warning.innerHTML = `
          <strong>âš ï¸ å¤–éƒ¨ç¶²ç«™å…§å®¹</strong><br>
          æ­¤å½±ç‰‡ä¾†è‡ªå¤–éƒ¨ç¶²ç«™ï¼Œè«‹æ³¨æ„ç¶²ç«™å®‰å…¨æ€§
        `;
        container.appendChild(warning);
        
      } else if (video.source === 'embed') {
        // ç›´æ¥åµŒå…¥ï¼ˆå¦‚ video æ¨™ç±¤ï¼‰
        const videoEl = document.createElement('video');
        videoEl.src = video.url;
        videoEl.controls = true;
        videoEl.autoplay = autoplay;
        videoEl.style.width = '100%';
        container.appendChild(videoEl);
        
      } else {
        // ç„¡æ³•åµŒå…¥ï¼Œé¡¯ç¤ºé€£çµ
        container.innerHTML = `
          <div class="video-thumbnail" style="background-image: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
            ğŸ”—
          </div>
          <div class="external-warning">
            <p>æ­¤å½±ç‰‡ç„¡æ³•ç›´æ¥åµŒå…¥</p>
            <a href="${video.url}" target="_blank" class="btn">å‰å¾€è§€çœ‹å½±ç‰‡</a>
          </div>
        `;
      }
    }
    
    function getSourceLabel(source) {
      const labels = {
        youtube: 'YouTube',
        external: 'å¤–éƒ¨ç¶²ç«™',
        embed: 'ç›´æ¥åµŒå…¥'
      };
      return labels[source] || source;
    }
    
    function updatePlaylist() {
      const playlistGrid = document.getElementById('playlist-grid');
      playlistGrid.innerHTML = '';
      
      filteredVideos.forEach((video, index) => {
        const item = document.createElement('div');
        item.className = `playlist-item ${index === currentIndex ? 'active' : ''}`;
        item.onclick = () => loadVideo(index);
        
        // ä½¿ç”¨ç¸®åœ–æˆ–é è¨­åœ–ç¤º
        let thumbnailHTML = '';
        if (video.thumbnail) {
          thumbnailHTML = `<div class="playlist-thumbnail" style="background-image: url('${video.thumbnail}')"></div>`;
        } else {
          thumbnailHTML = `<div class="playlist-thumbnail">${getVideoIcon(video.source)}</div>`;
        }
        
        item.innerHTML = `
          ${thumbnailHTML}
          <div class="playlist-info">
            <div class="playlist-video-title">
              ${video.title}
              ${video.source === 'youtube' ? '<span class="video-source-badge source-youtube">YT</span>' : ''}
              ${video.source === 'external' ? '<span class="video-source-badge source-external">EXT</span>' : ''}
            </div>
            <div class="playlist-video-duration">
              ${video.duration || ''} â€¢ ${window.videoCategories?.[video.category] || video.category || ''}
            </div>
          </div>
        `;
        
        playlistGrid.appendChild(item);
      });
      
      // æ·»åŠ å°šæœªæº–å‚™å¥½çš„å½±ç‰‡
      const comingSoon = videoList.filter(v => v.status === 'coming-soon');
      if (comingSoon.length > 0) {
        const section = document.createElement('div');
        section.style.gridColumn = '1 / -1';
        section.style.marginTop = '20px';
        section.innerHTML = `
          <h4>ğŸ› ï¸ è£½ä½œä¸­çš„å½±ç‰‡</h4>
          <div style="display: flex; gap: 10px; flex-wrap: wrap;">
            ${comingSoon.map(video => `
              <div style="padding: 10px; background: #f8f9fa; border-radius: 8px;">
                ${video.title}
              </div>
            `).join('')}
          </div>
        `;
        playlistGrid.appendChild(section);
      }
    }
    
    function getVideoIcon(source) {
      const icons = {
        youtube: 'ğŸ“º',
        external: 'ğŸ”—',
        embed: 'ğŸ¥'
      };
      return icons[source] || 'ğŸ¬';
    }
    
    function recordVideoView(videoId) {
      const key = `video_views_${videoId}`;
      let count = parseInt(localStorage.getItem(key) || '0');
      count++;
      localStorage.setItem(key, count.toString());
      
      // æ›´æ–°ç¸½è¨ˆæ•¸
      const totalKey = 'total_video_views';
      let total = parseInt(localStorage.getItem(totalKey) || '0');
      total++;
      localStorage.setItem(totalKey, total.toString());
      
      // æ›´æ–°é é¢é¡¯ç¤º
      document.getElementById('views_video').textContent = total;
    }
    
    // ä¿æŒåŸæœ‰çš„å°èˆªå‡½æ•¸
    function prevVideo() {
      if (currentIndex > 0) {
        currentIndex--;
        loadVideo(currentIndex);
      }
    }
    
    function nextVideo() {
      if (currentIndex < filteredVideos.length - 1) {
        currentIndex++;
        loadVideo(currentIndex);
      }
    }
    
    function updateVideoControls() {
      const prevBtn = document.getElementById('prev-btn');
      const nextBtn = document.getElementById('next-btn');
      
      if (prevBtn && nextBtn) {
        prevBtn.disabled = currentIndex === 0;
        nextBtn.disabled = currentIndex === filteredVideos.length - 1;
      }
    }
    
    function toggleAutoplay() {
      autoplay = !autoplay;
      const btn = document.getElementById('autoplay-btn');
      btn.textContent = `ğŸ”„ è‡ªå‹•æ’­æ”¾: ${autoplay ? 'é–‹å•Ÿ' : 'é—œé–‰'}`;
      
      // é‡æ–°è¼‰å…¥ç•¶å‰å½±ç‰‡ä»¥æ‡‰ç”¨è‡ªå‹•æ’­æ”¾
      if (filteredVideos[currentIndex]) {
        loadVideo(currentIndex);
      }
    }
    
    function openOriginal() {
      const video = filteredVideos[currentIndex];
      if (video) {
        let url = video.url;
        if (video.source === 'youtube') {
          // å°‡åµŒå…¥é€£çµè½‰ç‚ºè§€çœ‹é€£çµ
          url = url.replace('/embed/', '/watch?v=');
        }
        window.open(url, '_blank');
      }
    }
    
    function showStatus(message, type = 'info') {
      const status = document.getElementById('video-title');
      const icon = type === 'error' ? 'âŒ' : 'â³';
      status.textContent = `${icon} ${message}`;
    }
    
    function showNoVideosMessage() {
      document.getElementById("video-title").textContent = "æš«ç„¡å¯ç”¨å½±ç‰‡";
      document.getElementById("video-container").innerHTML = `
        <div style="text-align: center; padding: 40px;">
          <div style="font-size: 4rem; margin-bottom: 20px;">ğŸ“º</div>
          <h3>æ²’æœ‰æ‰¾åˆ°ç¬¦åˆæ¢ä»¶çš„å½±ç‰‡</h3>
          <p>è«‹å˜—è©¦é¸æ“‡å…¶ä»–ä¾†æºæˆ–åˆ†é¡</p>
        </div>
      `;
    }
    
    function loadFallbackVideos() {
      videoList = [
        {
          id: 'fallback1',
          title: 'Scratch åŸºç¤æ•™å­¸',
          description: 'Scratch ç¨‹å¼è¨­è¨ˆå…¥é–€æ•™å­¸',
          url: 'https://www.youtube.com/embed/aCZPHX13ZnE',
          source: 'youtube',
          channel: 'chday7919',
          category: 'scratch',
          duration: '15:30',
          status: 'ready'
        }
      ];
      applyVideoFilters();
    }
    
    // åˆå§‹åŒ–
    document.addEventListener('DOMContentLoaded', function() {
      loadVideoList();
      
      // è¼‰å…¥ç€è¦½æ¬¡æ•¸
      const totalViews = localStorage.getItem('total_video_views') || '0';
      document.getElementById('views_video').textContent = totalViews;
    });
  </script>
</body>
</html>