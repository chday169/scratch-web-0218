<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ğŸ¥ å½±ç‰‡æ•™å­¸ä¸­å¿ƒ | CHDAY169</title>
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">
  <link rel="stylesheet" href="assets/style.css">
  <style>
    /* æ­¤è™•CSSæ¨£å¼èˆ‡æ‚¨æä¾›çš„å®Œå…¨ä¸€è‡´ï¼Œç‚ºç¯€çœç¯‡å¹…å·²æŠ˜ç–Šï¼Œå¯¦éš›æ›¿æ›æ™‚è«‹ä¿ç•™ */
    .video-source-badge { display: inline-block; padding: 4px 8px; font-size: 0.8rem; border-radius: 10px; margin-left: 8px; font-weight: 500; }
    .source-embed { background: #28a745; color: white; }
    .source-mychannel { background: #ff0000; color: white; }
    .channel-badge { background: #6c757d; color: white; padding: 3px 8px; border-radius: 10px; font-size: 0.75rem; margin-left: 5px; }
    .video-source-filter { display: flex; gap: 10px; margin: 20px 0; padding: 15px; background: #f8f9fa; border-radius: 8px; flex-wrap: wrap; }
    .source-filter-btn { padding: 6px 12px; background: white; border: 1px solid #dee2e6; border-radius: 20px; cursor: pointer; font-size: 0.9rem; transition: all 0.3s ease; }
    .source-filter-btn.active { background: #4a6fa5; color: white; border-color: #4a6fa5; }
    .external-warning { background: #fff3cd; border: 1px solid #ffeaa7; color: #856404; padding: 15px; border-radius: 8px; margin: 15px 0; text-align: center; }
    .video-thumbnail { width: 100%; aspect-ratio: 16/9; background-size: cover; background-position: center; border-radius: 8px; margin-bottom: 10px; display: flex; align-items: center; justify-content: center; font-size: 3rem; color: white; text-shadow: 0 2px 4px rgba(0,0,0,0.3); }
    .return-to-home { text-align: center; margin: 40px 0 20px; padding-top: 20px; border-top: 1px solid #dee2e6; }
    .home-btn { display: inline-flex; align-items: center; gap: 8px; padding: 12px 24px; background: #4a6fa5; color: white; text-decoration: none; border-radius: 8px; font-weight: 500; transition: all 0.3s ease; border: none; cursor: pointer; font-size: 1rem; }
    .home-btn:hover { background: #3a5a8c; transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.15); }
    .subscribe-section { text-align: center; margin: 30px 0; padding: 25px; background: linear-gradient(135deg, #ffebee 0%, #ffcdd2 100%); border-radius: 12px; border: 1px solid #ff8a80; }
    .subscribe-title { font-size: 1.4rem; color: #d32f2f; margin-bottom: 15px; font-weight: 600; }
    .subscribe-btn { display: inline-flex; align-items: center; gap: 10px; margin-top: 15px; padding: 12px 24px; background: #ff0000; color: white; text-decoration: none; border-radius: 8px; font-weight: 600; transition: all 0.3s ease; border: none; cursor: pointer; font-size: 1rem; }
    .subscribe-btn:hover { background: #cc0000; transform: translateY(-2px); box-shadow: 0 4px 12px rgba(255, 0, 0, 0.3); }
    .video-container { max-width: 1000px; margin: 0 auto; padding: 20px; }
    .video-player-section { background: white; border-radius: 12px; padding: 25px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); margin-bottom: 25px; }
    .video-title { font-size: 1.5rem; font-weight: 600; color: #333; margin-bottom: 20px; text-align: center; }
    .video-wrapper { position: relative; width: 100%; max-width: 800px; margin: 0 auto 20px auto; border-radius: 8px; overflow: hidden; box-shadow: 0 6px 20px rgba(0,0,0,0.15); }
    .video-wrapper iframe { width: 100%; height: 450px; border: none; display: block; }
    .video-info { display: flex; justify-content: space-between; align-items: center; margin: 20px 0; padding: 15px; background: #f8f9fa; border-radius: 8px; flex-wrap: wrap; gap: 10px; }
    .video-counter { font-weight: 600; color: #333; font-size: 1.1rem; }
    .video-category { background: #e8f5e9; color: #2e7d32; padding: 6px 15px; border-radius: 20px; font-size: 0.9rem; font-weight: 500; }
    .video-source { font-size: 0.9rem; color: #666; }
    .video-description { text-align: left; color: #555; line-height: 1.6; margin: 20px 0; padding: 20px; background: #f8f9fa; border-radius: 8px; }
    .video-controls { display: flex; justify-content: center; align-items: center; gap: 15px; margin: 25px 0; flex-wrap: wrap; }
    .video-btn { padding: 12px 24px; font-size: 1.1rem; background: #4a6fa5; color: white; border: none; border-radius: 8px; cursor: pointer; transition: all 0.3s ease; display: flex; align-items: center; gap: 8px; }
    .video-btn:hover { background: #3a5a8c; transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.15); }
    .video-btn:disabled { background: #cccccc; cursor: not-allowed; transform: none; box-shadow: none; }
    .video-playlist { background: white; border-radius: 12px; padding: 25px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); margin-bottom: 25px; }
    .playlist-title { font-size: 1.3rem; font-weight: 600; color: #333; margin-bottom: 20px; text-align: center; }
    .playlist-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 15px; }
    .playlist-item { background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 8px; padding: 15px; cursor: pointer; transition: all 0.3s ease; display: flex; align-items: center; gap: 12px; }
    .playlist-item:hover { background: #e9ecef; border-color: #adb5bd; transform: translateY(-2px); }
    .playlist-item.active { background: #4a6fa5; color: white; border-color: #4a6fa5; }
    .playlist-thumbnail { width: 90px; height: 60px; background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%); border-radius: 6px; display: flex; align-items: center; justify-content: center; font-size: 1.8rem; flex-shrink: 0; color: white; }
    .playlist-info { flex: 1; min-width: 0; }
    .playlist-video-title { font-weight: 600; margin-bottom: 5px; font-size: 0.95rem; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .playlist-video-duration { font-size: 0.8rem; color: #6c757d; }
    .coming-soon-section { background: #f0f0f0; border-radius: 8px; padding: 20px; margin-top: 30px; }
    .coming-soon-title { font-size: 1.1rem; color: #666; margin-bottom: 15px; }
    @media (max-width: 768px) {
      .video-source-filter { flex-direction: column; align-items: flex-start; }
      .source-filter-btn { width: 100%; }
      .home-btn, .subscribe-btn { width: 100%; justify-content: center; }
      .video-wrapper iframe { height: 300px; }
      .video-controls { flex-direction: column; }
      .video-btn { width: 100%; justify-content: center; }
      .playlist-grid { grid-template-columns: 1fr; }
    }
    @media (max-width: 480px) {
      .video-wrapper iframe { height: 250px; }
      .video-title { font-size: 1.3rem; }
      .video-container { padding: 15px; }
    }
  </style>
</head>
<body class="container">
  <header class="page-header">
    <h1>ğŸ¥ å½±ç‰‡æ•™å­¸ä¸­å¿ƒ</h1>
    <p class="subtitle">Scratch ç¨‹å¼è¨­è¨ˆèˆ‡å„é¡æ•™å­¸å½±ç‰‡ç²¾é¸</p>
    
    <div class="video-source-filter">
      <strong>ğŸ¬ å½±ç‰‡ä¾†æºï¼š</strong>
      <button onclick="filterSource('all')" class="source-filter-btn active">å…¨éƒ¨ä¾†æº</button>
      <button onclick="filterSource('embed')" class="source-filter-btn">
        ç›´æ¥åµŒå…¥ <span class="video-source-badge source-embed">EMB</span>
      </button>
      <button onclick="filterSource('mychannel')" class="source-filter-btn">
        @chday7919 <span class="video-source-badge source-mychannel">YT</span>
      </button>
      <button onclick="filterSource('external')" class="source-filter-btn">
        å¤–éƒ¨ç¶²ç«™ <span class="video-source-badge source-external">EXT</span>
      </button>
    </div>
  </header>
  
  <nav class="breadcrumb">
    <a href="index.html">é¦–é </a> &gt; <span>æ•™å­¸å½±ç‰‡</span>
  </nav>
  
  <main class="video-container">
    <section class="video-player-section">
      <div class="video-title" id="video-title">è¼‰å…¥ä¸­...</div>
      
      <div id="video-container" class="video-wrapper">
        <!-- å½±ç‰‡å°‡å‹•æ…‹è¼‰å…¥åˆ°æ­¤è™• -->
      </div>
      
      <div id="subscribe-section" class="subscribe-section" style="display: none;">
        <div class="subscribe-title">ğŸ“º è¨‚é–±æˆ‘çš„é »é“</div>
        <p>å–œæ­¡é€™å€‹æ•™å­¸å½±ç‰‡å—ï¼Ÿæ­¡è¿è¨‚é–±æˆ‘çš„ YouTube é »é“ï¼Œç²å–æ›´å¤šæ•™å­¸å…§å®¹ï¼</p>
        <button onclick="openChannelLink('subscribe')" class="subscribe-btn">
          <span style="font-size: 1.2rem;">â–¶ï¸</span> è¨‚é–± @chday7919
        </button>
        <p style="margin-top: 15px; font-size: 0.9rem; color: #666;">
          è¨‚é–±å¾Œå³å¯ç¬¬ä¸€æ™‚é–“æ”¶åˆ°æ–°å½±ç‰‡é€šçŸ¥ï¼
        </p>
      </div>
      
      <div class="video-info">
        <div class="video-counter" id="video-counter">å½±ç‰‡ 0 / 0</div>
        <div class="video-category" id="video-category">-</div>
        <div class="video-source" id="video-source">-</div>
      </div>
      
      <div class="video-description" id="video-description">
        å½±ç‰‡èªªæ˜è¼‰å…¥ä¸­...
      </div>
      
      <div class="video-controls">
        <button onclick="prevVideo()" class="video-btn" id="prev-btn" disabled>
          â¬…ï¸ ä¸Šä¸€éƒ¨å½±ç‰‡
        </button>
        <button onclick="nextVideo()" class="video-btn" id="next-btn" disabled>
          â¡ï¸ ä¸‹ä¸€éƒ¨å½±ç‰‡
        </button>
        <button onclick="toggleAutoplay()" class="video-btn" id="autoplay-btn">
          ğŸ”„ è‡ªå‹•æ’­æ”¾: é—œé–‰
        </button>
        <button onclick="openOriginal()" class="video-btn" id="original-btn" style="display: none;">
          ğŸŒ å‰å¾€ä¾†æºç¶²ç«™
        </button>
      </div>
    </section>
    
    <section class="video-playlist">
      <h3 class="playlist-title">ğŸ“‹ å½±ç‰‡æ’­æ”¾æ¸…å–®</h3>
      <div class="playlist-grid" id="playlist-grid">
        <!-- æ’­æ”¾æ¸…å–®é …ç›®æœƒç”± JavaScript å‹•æ…‹ç”Ÿæˆ -->
      </div>
      
      <div id="coming-soon-section" class="coming-soon-section" style="display: none;">
        <div class="coming-soon-title">ğŸ› ï¸ è£½ä½œä¸­çš„å½±ç‰‡</div>
        <div id="coming-soon-list"></div>
      </div>
    </section>
    
    <!-- é »é“é€£çµå€å¡Š -->
    <section class="subscribe-section">
      <div class="subscribe-title">ğŸ“º è§€çœ‹æ›´å¤šå½±ç‰‡</div>
      <p>æ­¡è¿å‰å¾€æˆ‘çš„ YouTube é »é“è§€çœ‹æ‰€æœ‰æ•™å­¸å½±ç‰‡ï¼</p>
      <button onclick="openChannelLink('view')" class="subscribe-btn">
        ğŸ¬ å‰å¾€ CHDAY169 YouTube é »é“
      </button>
      <div style="margin-top: 15px;">
        <p style="font-size: 0.9rem; color: #666;">
          é »é“å…§æœ‰å®Œæ•´çš„æ•™å­¸æ’­æ”¾æ¸…å–®å’Œæ›´å¤šç²¾å½©å…§å®¹ï¼
        </p>
      </div>
    </section>
  </main>
  
  <div class="return-to-home">
    <a href="index.html" class="home-btn">
      ğŸ  è¿”å›é¦–é 
    </a>
  </div>
  
  <script>
    const videoListURL = './data_scr/video_list.json';
    
    let videoList = [];
    let filteredVideos = [];
    let currentIndex = 0;
    let autoplay = false;
    let currentFilter = {
      category: 'all',
      source: 'all'
    };
    
    // è¼‰å…¥å½±ç‰‡æ¸…å–®
    async function loadVideoList() {
      try {
        showStatus('è¼‰å…¥å½±ç‰‡æ¸…å–®ä¸­...');
        
        const response = await fetch(videoListURL + '?t=' + new Date().getTime());
        if (!response.ok) throw new Error('ç„¡æ³•è¼‰å…¥å½±ç‰‡æ¸…å–®');
        
        const data = await response.json();
        if (!data.videos || !Array.isArray(data.videos)) {
          throw new Error('å½±ç‰‡æ¸…å–®æ ¼å¼éŒ¯èª¤');
        }
        
        videoList = data.videos;
        console.log('è¼‰å…¥å½±ç‰‡æ•¸é‡:', videoList.length);
        
        if (data.categories) window.videoCategories = data.categories;
        if (data.channels) window.videoChannels = data.channels;
        
        applyVideoFilters();
        
        if (videoList.length > 0) {
          showStatus(`æ‰¾åˆ° ${videoList.length} å€‹å½±ç‰‡`);
        } else {
          showStatus('âŒ æ²’æœ‰å¯ç”¨çš„å½±ç‰‡', 'error');
        }
      } catch (err) {
        console.error('è¼‰å…¥éŒ¯èª¤ï¼š', err);
        showStatus('âŒ ç„¡æ³•è¼‰å…¥å½±ç‰‡æ¸…å–®', 'error');
        loadFallbackVideos();
      }
    }
    
    function applyVideoFilters() {
      console.log('å¥—ç”¨ç¯©é¸å™¨:', currentFilter);
      
      filteredVideos = videoList.filter(video => {
        // åªé¡¯ç¤ºç‹€æ…‹ç‚º ready çš„å½±ç‰‡
        if (video.status !== 'ready') return false;
        
        // ä¾†æºéæ¿¾
        if (currentFilter.source !== 'all') {
          let videoSource = video.source;
          
          // è™•ç† YouTube ä¾†æº
          if (video.source === 'youtube' || video.source === 'mychannel') {
            if (isMyChannelVideo(video)) {
              videoSource = 'mychannel';
            } else {
              videoSource = 'external';
            }
          }
          
          console.log(`å½±ç‰‡ ${video.title}: ä¾†æº=${videoSource}, ç¯©é¸=${currentFilter.source}`);
          
          if (videoSource !== currentFilter.source) {
            return false;
          }
        }
        
        // åˆ†é¡éæ¿¾
        if (currentFilter.category !== 'all' && video.category !== currentFilter.category) {
          return false;
        }
        
        return true;
      });
      
      console.log('ç¯©é¸å¾Œå½±ç‰‡æ•¸é‡:', filteredVideos.length);
      
      updatePlaylist();
      
      // é¡¯ç¤ºå³å°‡ä¸Šç·šå€å¡Š
      const comingSoonVideos = videoList.filter(video => video.status === 'coming-soon');
      const comingSoonSection = document.getElementById('coming-soon-section');
      const comingSoonList = document.getElementById('coming-soon-list');
      
      if (comingSoonVideos.length > 0) {
        comingSoonSection.style.display = 'block';
        comingSoonList.innerHTML = comingSoonVideos.map(video => `
          <div style="padding: 10px; margin-bottom: 8px; background: white; border-radius: 6px; border-left: 4px solid #ff9800;">
            <strong>${video.title}</strong>
            <div style="font-size: 0.8rem; color: #666; margin-top: 4px;">
              ${video.description || 'è©³ç´°å…§å®¹æº–å‚™ä¸­...'}
            </div>
          </div>
        `).join('');
      } else {
        comingSoonSection.style.display = 'none';
      }
      
      if (filteredVideos.length > 0) {
        loadVideo(0);
      } else {
        showNoVideosMessage();
      }
    }
    
    function filterSource(source) {
      console.log('ç¯©é¸ä¾†æº:', source);
      
      // æ›´æ–°æŒ‰éˆ•ç‹€æ…‹
      document.querySelectorAll('.source-filter-btn').forEach(btn => {
        btn.classList.remove('active');
      });
      event.currentTarget.classList.add('active');
      
      currentFilter.source = source;
      applyVideoFilters();
    }
    
    function loadVideo(index) {
      if (index < 0 || index >= filteredVideos.length) return;
      
      currentIndex = index;
      const video = filteredVideos[index];
      
      console.log('è¼‰å…¥å½±ç‰‡:', video.title, 'ç´¢å¼•:', index);
      
      document.getElementById("video-title").textContent = video.title;
      document.getElementById("video-description").textContent = video.description || 'ç„¡æè¿°';
      document.getElementById("video-counter").textContent = `å½±ç‰‡ ${index + 1} / ${filteredVideos.length}`;
      document.getElementById("video-category").textContent = 
        window.videoCategories?.[video.category] || video.category || '-';
      
      const sourceEl = document.getElementById("video-source");
      let sourceText = getSourceLabel(video);
      if (video.channel && window.videoChannels?.[video.channel]) {
        sourceText += ` â€¢ ${window.videoChannels[video.channel]}`;
      }
      sourceEl.textContent = sourceText;
      
      const subscribeSection = document.getElementById('subscribe-section');
      if (isMyChannelVideo(video)) {
        subscribeSection.style.display = 'block';
      } else {
        subscribeSection.style.display = 'none';
      }
      
      renderVideoPlayer(video);
      updateVideoControls();
      
      const originalBtn = document.getElementById("original-btn");
      if (video.url && (video.source === 'external' || video.source === 'youtube')) {
        originalBtn.style.display = 'inline-block';
        originalBtn.onclick = () => openVideoInNewTab(video);
      } else {
        originalBtn.style.display = 'none';
      }
      
      recordVideoView(video.id);
    }
    
    function isMyChannelVideo(video) {
      // åˆ¤æ–·æ˜¯å¦ç‚ºæˆ‘çš„é »é“å½±ç‰‡
      if (video.source === 'mychannel') return true;
      if (video.source === 'youtube') {
        const myChannels = ['chday7919', 'chday19797', 'CHDAY169', 'chday'];
        if (video.channel && myChannels.some(ch => video.channel.toLowerCase().includes(ch.toLowerCase()))) {
          return true;
        }
      }
      return false;
    }
    
    function getSourceLabel(video) {
      if (isMyChannelVideo(video)) return 'æˆ‘çš„é »é“ @chday7919';
      if (video.source === 'external') return 'å¤–éƒ¨ç¶²ç«™';
      if (video.source === 'embed') return 'ç›´æ¥åµŒå…¥';
      if (video.source === 'youtube') return 'YouTube å½±ç‰‡';
      return video.source || 'æœªçŸ¥ä¾†æº';
    }
    
    function renderVideoPlayer(video) {
      const container = document.getElementById("video-container");
      container.innerHTML = '';
      
      if (!video.url) {
        container.innerHTML = `
          <div style="text-align: center; padding: 40px;">
            <div style="font-size: 4rem; margin-bottom: 20px;">ğŸ“º</div>
            <h3>å½±ç‰‡é€£çµä¸å¯ç”¨</h3>
            <p>æ­¤å½±ç‰‡æš«æ™‚ç„¡æ³•æ’­æ”¾</p>
          </div>
        `;
        return;
      }
      
      if (video.source === 'youtube' || video.source === 'mychannel') {
        // YouTube åµŒå…¥
        const iframe = document.createElement('iframe');
        let embedUrl = video.url;
        
        if (video.url.includes('youtube.com/watch?v=')) {
          embedUrl = video.url.replace('youtube.com/watch?v=', 'youtube.com/embed/');
        } else if (video.url.includes('youtu.be/')) {
          embedUrl = video.url.replace('youtu.be/', 'youtube.com/embed/');
        }
        
        iframe.src = embedUrl + (embedUrl.includes('?') ? '&' : '?') + 'rel=0&modestbranding=1';
        if (autoplay) iframe.src += '&autoplay=1';
        
        iframe.allowFullscreen = true;
        iframe.allow = "accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture";
        iframe.title = video.title;
        iframe.loading = "lazy";
        iframe.style.width = '100%';
        iframe.style.height = '450px';
        container.appendChild(iframe);
        
        const youtubeBadge = document.createElement('div');
        youtubeBadge.style.textAlign = 'center';
        youtubeBadge.style.marginTop = '10px';
        if (isMyChannelVideo(video)) {
          youtubeBadge.innerHTML = `<span class="channel-badge">YouTube @chday7919</span>`;
        } else {
          youtubeBadge.innerHTML = `<span class="channel-badge">YouTube</span>`;
        }
        container.appendChild(youtubeBadge);
        
      } else if (video.source === 'embed') {
        if (video.url.match(/\.(mp4|webm|ogg)$/i)) {
          const videoEl = document.createElement('video');
          videoEl.src = video.url;
          videoEl.controls = true;
          videoEl.autoplay = autoplay;
          videoEl.style.width = '100%';
          videoEl.style.height = '450px';
          container.appendChild(videoEl);
        } else {
          const iframe = document.createElement('iframe');
          iframe.src = video.url;
          iframe.allowFullscreen = true;
          iframe.title = video.title;
          iframe.style.width = '100%';
          iframe.style.height = '450px';
          container.appendChild(iframe);
        }
        
      } else if (video.source === 'external') {
        const iframe = document.createElement('iframe');
        iframe.src = video.url;
        iframe.allowFullscreen = true;
        iframe.title = video.title;
        iframe.style.width = '100%';
        iframe.style.height = '450px';
        container.appendChild(iframe);
        
        const warning = document.createElement('div');
        warning.className = 'external-warning';
        warning.innerHTML = `
          <strong>âš ï¸ å¤–éƒ¨ç¶²ç«™å…§å®¹</strong><br>
          æ­¤å½±ç‰‡ä¾†è‡ªå¤–éƒ¨ç¶²ç«™ï¼Œè«‹æ³¨æ„ç¶²ç«™å®‰å…¨æ€§
        `;
        container.appendChild(warning);
      }
    }
    
    function openVideoInNewTab(video) {
      let url = video.url;
      if (video.source === 'youtube' || video.source === 'mychannel') {
        if (url.includes('youtube.com/embed/')) {
          url = url.replace('youtube.com/embed/', 'youtube.com/watch?v=');
        }
      }
      window.open(url, '_blank', 'noopener,noreferrer');
    }
    
    function updatePlaylist() {
      const playlistGrid = document.getElementById('playlist-grid');
      playlistGrid.innerHTML = '';
      
      filteredVideos.forEach((video, index) => {
        const item = document.createElement('div');
        item.className = `playlist-item ${index === currentIndex ? 'active' : ''}`;
        item.onclick = () => loadVideo(index);
        
        let thumbnailHTML = '';
        if (video.thumbnail) {
          thumbnailHTML = `<div class="playlist-thumbnail" style="background-image: url('${video.thumbnail}')"></div>`;
        } else {
          const icon = getVideoIcon(video);
          thumbnailHTML = `<div class="playlist-thumbnail">${icon}</div>`;
        }
        
        let sourceBadge = '';
        if (isMyChannelVideo(video)) {
          sourceBadge = '<span class="video-source-badge source-mychannel">YT</span>';
        } else if (video.source === 'embed') {
          sourceBadge = '<span class="video-source-badge source-embed">EMB</span>';
        } else if (video.source === 'external') {
          sourceBadge = '<span class="video-source-badge source-external">EXT</span>';
        }
        
        item.innerHTML = `
          ${thumbnailHTML}
          <div class="playlist-info">
            <div class="playlist-video-title">
              ${video.title}
              ${sourceBadge}
            </div>
            <div class="playlist-video-duration">
              ${video.duration || ''} â€¢ ${window.videoCategories?.[video.category] || video.category || ''}
            </div>
          </div>
        `;
        
        playlistGrid.appendChild(item);
      });
    }
    
    function getVideoIcon(video) {
      if (isMyChannelVideo(video)) return 'ğŸ“º';
      if (video.source === 'embed') return 'ğŸ¥';
      if (video.source === 'external') return 'ğŸ”—';
      return 'ğŸ¬';
    }
    
    function recordVideoView(videoId) {
      if (!videoId) return;
      
      const key = `video_views_${videoId}`;
      let count = parseInt(localStorage.getItem(key) || '0');
      count++;
      localStorage.setItem(key, count.toString());
      
      const totalKey = 'total_video_views';
      let total = parseInt(localStorage.getItem(totalKey) || '0');
      total++;
      localStorage.setItem(totalKey, total.toString());
      
      const pageKey = 'views_video';
      let pageViews = parseInt(localStorage.getItem(pageKey) || '0');
      pageViews++;
      localStorage.setItem(pageKey, pageViews.toString());
    }
    
    function prevVideo() {
      if (currentIndex > 0) {
        currentIndex--;
        loadVideo(currentIndex);
      }
    }
    
    function nextVideo() {
      if (currentIndex < filteredVideos.length - 1) {
        currentIndex++;
        loadVideo(currentIndex);
      }
    }
    
    function updateVideoControls() {
      const prevBtn = document.getElementById('prev-btn');
      const nextBtn = document.getElementById('next-btn');
      
      if (prevBtn && nextBtn) {
        prevBtn.disabled = currentIndex === 0;
        nextBtn.disabled = currentIndex === filteredVideos.length - 1;
      }
    }
    
    function toggleAutoplay() {
      autoplay = !autoplay;
      const btn = document.getElementById('autoplay-btn');
      btn.textContent = `ğŸ”„ è‡ªå‹•æ’­æ”¾: ${autoplay ? 'é–‹å•Ÿ' : 'é—œé–‰'}`;
      
      if (filteredVideos[currentIndex]) {
        loadVideo(currentIndex);
      }
    }
    
    function openOriginal() {
      const video = filteredVideos[currentIndex];
      if (video) {
        openVideoInNewTab(video);
      }
    }
    
    // ==================== æ ¸å¿ƒä¿®å¾©ï¼šç©©å¥çš„é »é“é€£çµè™•ç†å‡½æ•¸ ====================
    function openChannelLink(action) {
      const baseUrl = 'https://www.youtube.com/@chday7919';
      const targetUrl = action === 'subscribe' ? baseUrl + '?sub_confirmation=1' : baseUrl;
      
      // å»ºç«‹ä¸€å€‹éš±è—çš„iframeä¾†æ¸¬è©¦é€£çµæ˜¯å¦æœ‰ç”¨
      const testFrame = document.createElement('iframe');
      testFrame.style.display = 'none';
      testFrame.src = targetUrl;
      
      testFrame.onload = function() {
        // å¦‚æœèƒ½è¼‰å…¥ï¼Œå‰‡ç”¨æ–°è¦–çª—é–‹å•ŸçœŸå¯¦é€£çµ
        window.open(targetUrl, '_blank', 'noopener,noreferrer');
        document.body.removeChild(testFrame);
      };
      
      testFrame.onerror = function() {
        // å¦‚æœè¼‰å…¥å¤±æ•—ï¼Œçµ¦ä½¿ç”¨è€…æ˜ç¢ºçš„ç¹é«”ä¸­æ–‡æç¤º
        const message = 'æŠ±æ­‰ï¼Œç›®å‰ç„¡æ³•é€£æ¥åˆ° YouTube é »é“ "@chday7919"ã€‚\n\n' +
                        'å¯èƒ½çš„åŸå› ï¼š\n' +
                        '1. è©²é »é“å¯èƒ½å°šæœªå»ºç«‹æˆ–å·²è®Šæ›´åç¨±ã€‚\n' +
                        '2. æ‚¨çš„ç¶²è·¯æš«æ™‚ç„¡æ³•å­˜å– YouTubeã€‚\n' +
                        '3. è©²é »é“è¨­å®šäº†å­˜å–æ¬Šé™ã€‚\n\n' +
                        'æ‚¨å¯ä»¥å˜—è©¦åœ¨ YouTube ç›´æ¥æœå°‹ "CHDAY169" æŸ¥æ‰¾ç›¸é—œå…§å®¹ã€‚';
        alert(message);
        document.body.removeChild(testFrame);
      };
      
      document.body.appendChild(testFrame);
    }
    // ==================== æ ¸å¿ƒä¿®å¾©çµæŸ ====================
    
    function showStatus(message, type = 'info') {
      const status = document.getElementById('video-title');
      const icon = type === 'error' ? 'âŒ' : 'â³';
      status.textContent = `${icon} ${message}`;
    }
    
    function showNoVideosMessage() {
      document.getElementById("video-title").textContent = "æš«ç„¡å¯ç”¨å½±ç‰‡";
      document.getElementById("video-container").innerHTML = `
        <div style="text-align: center; padding: 40px;">
          <div style="font-size: 4rem; margin-bottom: 20px;">ğŸ“º</div>
          <h3>æ²’æœ‰æ‰¾åˆ°ç¬¦åˆæ¢ä»¶çš„å½±ç‰‡</h3>
          <p>è«‹å˜—è©¦é¸æ“‡å…¶ä»–ä¾†æºæˆ–åˆ†é¡</p>
        </div>
      `;
    }
    
    function loadFallbackVideos() {
      videoList = [
        {
          id: 'fallback1',
          title: 'Scratch åŸºç¤æ•™å­¸ - è¸èŠ±æ­¸å»é¦¬è¹„é¦™',
          description: 'Scratch ç¨‹å¼è¨­è¨ˆå…¥é–€æ•™å­¸ï¼Œå­¸ç¿’å¦‚ä½•å‰µä½œå„ªç¾çš„å‹•ç•«æ•ˆæœ',
          url: 'https://www.youtube.com/embed/aCZPHX13ZnE',
          source: 'mychannel',
          channel: 'chday7919',
          category: 'scratch',
          duration: '15:30',
          thumbnail: 'https://img.youtube.com/vi/aCZPHX13ZnE/0.jpg',
          status: 'ready'
        },
        {
          id: 'fallback2',
          title: 'Scratch é›»å­é˜è¨­è¨ˆå‹•ç•«æ•™å­¸',
          description: 'å¯¦ä½œ Scratch é›»å­é˜å°ˆæ¡ˆï¼Œå­¸ç¿’æ™‚é–“è™•ç†èˆ‡æ•¸å­—é¡¯ç¤º',
          url: 'https://www.youtube.com/embed/Aql3YLDG2a8',
          source: 'mychannel',
          channel: 'chday7919',
          category: 'scratch',
          duration: '12:45',
          thumbnail: 'https://img.youtube.com/vi/Aql3YLDG2a8/0.jpg',
          status: 'ready'
        }
      ];
      applyVideoFilters();
    }
    
    // åˆå§‹åŒ–
    document.addEventListener('DOMContentLoaded', function() {
      console.log('å½±ç‰‡æ’­æ”¾å™¨åˆå§‹åŒ–...');
      loadVideoList();
    });
    
    // éµç›¤å¿«æ·éµ
    document.addEventListener('keydown', function(event) {
      if (event.key === 'ArrowLeft') {
        prevVideo();
        event.preventDefault();
      } else if (event.key === 'ArrowRight') {
        nextVideo();
        event.preventDefault();
      } else if (event.key === ' ') {
        event.preventDefault();
        toggleAutoplay();
      }
    });
  </script>
</body>
</html>