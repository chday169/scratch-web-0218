<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ğŸ“š Scratch æ•™æç€è¦½å™¨</title>
  <link rel="stylesheet" href="assets/style.css">
  <style>
    .pdf-controls {
      display: flex;
      gap: 15px;
      margin: 20px 0;
      flex-wrap: wrap;
      align-items: center;
    }
    .filter-select {
      padding: 10px 15px;
      border: 1px solid #dee2e6;
      border-radius: 8px;
      font-size: 1rem;
      min-width: 200px;
      background: white;
    }
    .stats-badge {
      display: inline-block;
      padding: 5px 10px;
      background: #4a6fa5;
      color: white;
      border-radius: 20px;
      font-size: 0.9rem;
      margin-left: 10px;
    }
    .pdf-list-container {
      background: white;
      border-radius: 12px;
      padding: 20px;
      margin-top: 20px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.05);
    }
    #pdf-list {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }
    .pdf-item {
      background: #f8f9fa;
      border-radius: 10px;
      padding: 20px;
      border: 2px solid #e9ecef;
      cursor: pointer;
      transition: all 0.3s ease;
      position: relative;
    }
    .pdf-item:hover {
      border-color: #4a6fa5;
      transform: translateY(-3px);
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }
    .pdf-item.embedded {
      border-left: 5px solid #4a6fa5;
    }
    .pdf-item.download-only {
      border-left: 5px solid #28a745;
    }
    .pdf-title {
      font-weight: 600;
      font-size: 1.1rem;
      color: #2c3e50;
      margin-bottom: 8px;
    }
    .pdf-description {
      font-size: 0.9rem;
      color: #6c757d;
      margin-bottom: 12px;
      line-height: 1.5;
    }
    .pdf-meta {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 10px;
    }
    .pdf-status {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 0.8rem;
      font-weight: 500;
    }
    .pdf-status.embedded {
      background: #4a6fa5;
      color: white;
    }
    .pdf-status.download {
      background: #28a745;
      color: white;
    }
    .pdf-views {
      font-size: 0.85rem;
      color: #6c757d;
    }
    .pdf-actions {
      display: flex;
      gap: 10px;
      margin-top: 15px;
    }
    .pdf-action-btn {
      flex: 1;
      padding: 8px 12px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 0.9rem;
      transition: all 0.3s ease;
    }
    .view-btn {
      background: #4a6fa5;
      color: white;
    }
    .view-btn:hover {
      background: #3a5a8c;
    }
    .download-btn {
      background: #28a745;
      color: white;
    }
    .download-btn:hover {
      background: #218838;
    }
    .pdf-viewer-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.8);
      z-index: 1000;
      align-items: center;
      justify-content: center;
    }
    .pdf-viewer-container {
      background: white;
      border-radius: 12px;
      width: 90%;
      max-width: 1000px;
      height: 90%;
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }
    .pdf-viewer-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px 20px;
      background: #f8f9fa;
      border-bottom: 1px solid #dee2e6;
    }
    .pdf-viewer-title {
      font-size: 1.2rem;
      font-weight: 600;
      color: #2c3e50;
    }
    .close-viewer {
      background: none;
      border: none;
      font-size: 1.5rem;
      cursor: pointer;
      color: #6c757d;
      padding: 0 10px;
    }
    .close-viewer:hover {
      color: #dc3545;
    }
    .pdf-viewer-content {
      flex: 1;
      overflow: hidden;
    }
    .pdf-viewer-content iframe {
      width: 100%;
      height: 100%;
      border: none;
    }
    .stats-cards {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-top: 30px;
    }
    .stat-card {
      background: white;
      border-radius: 10px;
      padding: 20px;
      text-align: center;
      box-shadow: 0 2px 10px rgba(0,0,0,0.05);
    }
    .stat-number {
      font-size: 2.5rem;
      font-weight: bold;
      color: #4a6fa5;
      margin: 10px 0;
    }
    .stat-label {
      color: #6c757d;
      font-size: 0.9rem;
    }
    .loading {
      text-align: center;
      padding: 40px;
      color: #6c757d;
    }
    .loading-spinner {
      display: inline-block;
      width: 40px;
      height: 40px;
      border: 4px solid #f3f3f3;
      border-top: 4px solid #4a6fa5;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-bottom: 15px;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    @media (max-width: 768px) {
      #pdf-list {
        grid-template-columns: 1fr;
      }
      .pdf-controls {
        flex-direction: column;
        align-items: stretch;
      }
      .filter-select {
        width: 100%;
      }
      .pdf-viewer-container {
        width: 95%;
        height: 95%;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <header class="page-header">
      <h1>ğŸ“š Scratch æ•™æç€è¦½å™¨</h1>
      <p class="subtitle">5å€‹é åµŒæ•™æ + 28å€‹GitHubä¸‹è¼‰è³‡æº</p>
      <a href="index.html" class="btn btn-secondary">ğŸ  è¿”å›é¦–é </a>
    </header>
    
    <nav class="breadcrumb">
      <a href="index.html">é¦–é </a> / <span>Scratch æ•™æ</span>
    </nav>
    
    <main class="main-content">
      <div class="pdf-controls">
        <select id="category-filter" class="filter-select">
          <option value="all">ğŸ“š æ‰€æœ‰æ•™æ (33)</option>
          <option value="beginner">ğŸ‘¶ åˆå­¸è€…</option>
          <option value="setup">âš™ï¸ ç’°å¢ƒè¨­ç½®</option>
          <option value="basic">ğŸ“˜ åŸºç¤æ•™å­¸</option>
          <option value="design">ğŸ¨ è¨­è¨ˆèˆ‡ç¾è¡“</option>
          <option value="multimedia">ğŸµ å¤šåª’é«”</option>
          <option value="project">ğŸš€ å°ˆæ¡ˆå¯¦ä½œ</option>
          <option value="ai">ğŸ¤– AIæ‡‰ç”¨</option>
          <option value="creative">âœ¨ å‰µæ„è¨­è¨ˆ</option>
          <option value="math">ğŸ§® æ•¸å­¸æ‡‰ç”¨</option>
          <option value="advanced">âš¡ é€²éšæŠ€å·§</option>
          <option value="hardware">ğŸ”Œ ç¡¬é«”æ•´åˆ</option>
        </select>
        
        <div style="display: flex; gap: 10px; align-items: center;">
          <span>é¡¯ç¤º:</span>
          <button id="show-all" class="btn btn-sm">å…¨éƒ¨</button>
          <button id="show-embedded" class="btn btn-sm">é åµŒæ•™æ</button>
          <button id="show-download" class="btn btn-sm">ä¸‹è¼‰æ•™æ</button>
        </div>
      </div>
      
      <div class="pdf-list-container">
        <h3>ğŸ“– Scratch æ•™æåˆ—è¡¨ <span id="pdf-count" class="stats-badge">33</span></h3>
        <div id="pdf-list" class="pdf-list">
          <div class="loading">
            <div class="loading-spinner"></div>
            <p>æ­£åœ¨è¼‰å…¥æ•™æåˆ—è¡¨...</p>
          </div>
        </div>
      </div>
      
      <div class="stats-cards">
        <div class="stat-card">
          <div>ğŸ” é åµŒæ•™æ</div>
          <div class="stat-number" id="embedded-count">5</div>
          <div class="stat-label">å¯ç›´æ¥åœ¨ç·šé–±è®€(ä¸æ”¯æ´æ‰‹æ©Ÿ)</div>
        </div>
        <div class="stat-card">
          <div>â¬‡ï¸ ä¸‹è¼‰æ•™æ</div>
          <div class="stat-number" id="download-count">28</div>
          <div class="stat-label">å¾ GitHub ä¸‹è¼‰(ä¸æ”¯æ´æ‰‹æ©Ÿ)</div>
        </div>
        <div class="stat-card">
          <div>ğŸ‘ï¸ ç¸½ç€è¦½</div>
          <div class="stat-number" id="total-views">0</div>
          <div class="stat-label">æ¬¡æ•¸</div>
        </div>
      </div>
    </main>
    
    <div style="text-align: center; margin: 30px 0;">
      <a href="index.html" class="btn btn-primary">ğŸ  è¿”å›é¦–é </a>
      <a href="video-player.html?v=3.0" class="btn btn-secondary">ğŸ¥ è§€çœ‹å½±ç‰‡</a>
    </div>
  </div>
  
  <div id="pdf-viewer-overlay" class="pdf-viewer-overlay">
    <div class="pdf-viewer-container">
      <div class="pdf-viewer-header">
        <div class="pdf-viewer-title" id="pdf-viewer-title"></div>
        <button class="close-viewer" id="close-viewer">âœ•</button>
      </div>
      <div class="pdf-viewer-content">
        <iframe id="pdf-viewer-frame" src=""></iframe>
      </div>
    </div>
  </div>

<script>
// ========== ã€æ ¸å¿ƒä¿®å¤ã€‘ç«‹å³å®šä¹‰å…¨å±€å‡½æ•° ==========
// ç¡®ä¿HTMLä¸­çš„onclickèƒ½ç«‹åˆ»æ‰¾åˆ°è¿™äº›å‡½æ•°
window.viewPDF = function(pdfId) {
  const pdf = pdfManifest.find(p => p.id === pdfId);
  if (!pdf || !pdf.githubRelease) return;
  window.open(pdf.githubRelease, '_blank'); // ç›´æ¥æ‰“å¼€GitHubé“¾æ¥
  if (typeof incrementViewCount === 'function') incrementViewCount(pdfId);
};

window.downloadPDF = function(pdfId) {
  const pdf = pdfManifest.find(p => p.id === pdfId);
  if (!pdf || !pdf.githubRelease) return;
  window.open(pdf.githubRelease, '_blank'); // ç›´æ¥æ‰“å¼€GitHubé“¾æ¥
  if (typeof incrementViewCount === 'function') incrementViewCount(pdfId);
};

// ========== å…¨å±€è®Šæ•¸ ==========
let pdfManifest = [];
let pdfStats = {};

// ========== é é¢åˆå§‹åŒ– ==========
document.addEventListener('DOMContentLoaded', function() {
  loadPDFManifest();
  setupEventListeners();
  loadStats();
  recordPageView('scratch_viewer');
});

// ========== è¼‰å…¥æ•™ææ¸…å–® ==========
async function loadPDFManifest() {
  try {
    console.log('æ­£åœ¨è¼‰å…¥æ•™ææ¸…å–®...');
    // ç›´æ¥ä½¿ç”¨å…§ç½®çš„å®Œæ•´æ¸…å–®ï¼Œé¿å…ä»»ä½•ç¶²çµ¡æˆ–è·¯å¾‘å•é¡Œ
    const manifest = { pdfs: getFullManifestData() };
    pdfManifest = manifest.pdfs;
    loadSavedStats();
    renderPDFList();
    updateCounts();
  } catch (error) {
    console.error('è¼‰å…¥å¤±æ•—:', error);
    showErrorMessage('ç„¡æ³•è¼‰å…¥æ•™æåˆ—è¡¨ã€‚');
  }
}

// ========== ã€å®Œæ•´æ•¸æ“šã€‘33é …æ•™ææ¸…å–® ==========
function getFullManifestData() {
  return [
    // é åµŒæ•™æ (5é …)
    { id: "chapter0", title: "Scratchå¾é›¶é–‹å§‹çš„å‰µæ„ç¨‹å¼è¨­è¨ˆä¹‹æ—…", category: "beginner", githubRelease: "https://github.com/chday169/scratch-web-0218/releases/download/pdfs-scratch-new/chapter00.pdf", description: "Scratchå‰µæ„ç¨‹å¼è¨­è¨ˆå…¥é–€ç¯‡å°è®€", embedded: true },
    { id: "chapter1", title: "Scratch3ç¨‹å¼èªè¨€ä»‹ç´¹", category: "beginner", githubRelease: "https://github.com/chday169/scratch-web-0218/releases/download/pdfs-scratch-new/chapter01.pdf", description: "Scratch3ç¨‹å¼èªè¨€åŸºç¤ä»‹ç´¹", embedded: true },
    { id: "chapter2", title: "ScratcåŠurboWarpä¸‹è¼‰ã€å®‰è£", category: "setup", githubRelease: "https://github.com/chday169/scratch-web-0218/releases/download/pdfs-scratch-new/chapter02.pdf", description: "Scratchå’ŒTurboWarpä¸‹è¼‰å®‰è£æ•™å­¸", embedded: true },
    { id: "chapter7", title: "åœ–åƒçµ„åˆ", category: "design", githubRelease: "https://github.com/chday169/scratch-web-0218/releases/download/pdfs-scratch-new/chapter07.pdf", description: "åœ–åƒçµ„åˆèˆ‡åœ–å±¤ç®¡ç†æŠ€å·§", embedded: true },
    { id: "chapter16", title: "Scratchç¹ªè£½åœ“å½¢èˆ‡æ©¢åœ“", category: "math", githubRelease: "https://github.com/chday169/scratch-web-0218/releases/download/pdfs-scratch-new/chapter16.pdf", description: "ä½¿ç”¨Scratchç¹ªè£½å¹¾ä½•åœ–å½¢", embedded: true },

    // ä¸‹è¼‰æ•™æ (28é …)
    { id: "chapter3", title: "Scratch ä¸»è¦ç©æœ¨æ§‹ä»¶ä»‹ç´¹", category: "basic", githubRelease: "https://github.com/chday169/scratch-web-0218/releases/download/pdfs-scratch-new/chapter03.pdf", description: "Scratchä¸»è¦ç¨‹å¼ç©æœ¨ä»‹ç´¹", embedded: false },
    { id: "chapter4", title: "å»ºç«‹ Scratchï¼ˆæˆ– TurboWarpï¼‰å°ˆæ¡ˆ", category: "basic", githubRelease: "https://github.com/chday169/scratch-web-0218/releases/download/pdfs-scratch-new/chapter04.pdf", description: "å»ºç«‹å’Œç®¡ç†Scratchå°ˆæ¡ˆ", embedded: false },
    { id: "chapter5", title: "é€ å‹åŠèƒŒæ™¯ä¿®åœ–å·¥å…·", category: "design", githubRelease: "https://github.com/chday169/scratch-web-0218/releases/download/pdfs-scratch-new/chapter05.pdf", description: "è§’è‰²é€ å‹å’ŒèƒŒæ™¯ç·¨è¼¯å·¥å…·", embedded: false },
    { id: "chapter6", title: "é¡è‰²åŠé¡è‰²å¡«å……", category: "design", githubRelease: "https://github.com/chday169/scratch-web-0218/releases/download/pdfs-scratch-new/chapter06.pdf", description: "Scratché¡è‰²ç³»çµ±èˆ‡å¡«å……åŠŸèƒ½", embedded: false },
    { id: "chapter8", title: "èˆå°é¸å–åŠè§’è‰²é¸æ“‡", category: "basic", githubRelease: "https://github.com/chday169/scratch-web-0218/releases/download/pdfs-scratch-new/chapter08.pdf", description: "èˆå°ä½ˆæ™¯èˆ‡è§’è‰²ç®¡ç†", embedded: false },
    { id: "chapter9", title: "Scratchå‰µä½œæ—‹å¾‹å’Œèˆè¹ˆè¯å‹•", category: "multimedia", githubRelease: "https://github.com/chday169/scratch-web-0218/releases/download/pdfs-scratch-new/chapter09.pdf", description: "éŸ³æ¨‚å‰µä½œèˆ‡å‹•ç•«åŒæ­¥", embedded: false },
    { id: "chapter10", title: "Scratchè·‘é¦¬æ¨¡æ“¬", category: "multimedia", githubRelease: "https://github.com/chday169/scratch-web-0218/releases/download/pdfs-scratch-new/chapter10.pdf", description: "è·‘é¦¬ç‡ˆèˆ‡å‹•æ…‹æ–‡å­—æ•ˆæœ", embedded: false },
    { id: "chapter11", title: "éµçš„ä¸–ç•Œ", category: "project", githubRelease: "https://github.com/chday169/scratch-web-0218/releases/download/pdfs-scratch-new/chapter11.pdf", description: "è§’è‰²äº’å‹•èˆ‡æ•…äº‹å ´æ™¯è¨­è¨ˆ", embedded: false },
    { id: "chapter12", title: "Scratch è£½ä½œå¦‚ä½•ä½¿ç”¨AI Copilotã€ç°¡å ±", category: "ai", githubRelease: "https://github.com/chday169/scratch-web-0218/releases/download/pdfs-scratch-new/chapter12.pdf", description: "AIè¼”åŠ©ç·¨ç¨‹å·¥å…·æ‡‰ç”¨", embedded: false },
    { id: "chapter13", title: "è©©è©è³æ_å¤å…¸æ„å¢ƒèˆ‡Scratchå‰µä½œ", category: "creative", githubRelease: "https://github.com/chday169/scratch-web-0218/releases/download/pdfs-scratch-new/chapter13.pdf", description: "çµåˆæ–‡å­¸èˆ‡ç¨‹å¼è¨­è¨ˆ", embedded: false },
    { id: "chapter14", title: "é›»å­é˜è¨­è¨ˆ", category: "project", githubRelease: "https://github.com/chday169/scratch-web-0218/releases/download/pdfs-scratch-new/chapter14.pdf", description: "å¯¦ç”¨é›»å­æ™‚é˜ç¨‹å¼è¨­è¨ˆ", embedded: false },
    { id: "chapter15", title: "Scratchç¹ªåœ–èˆ‡ç¹ªåœ–åŠŸèƒ½", category: "design", githubRelease: "https://github.com/chday169/scratch-web-0218/releases/download/pdfs-scratch-new/chapter15.pdf", description: "Scratchç¹ªåœ–å·¥å…·æ•™å­¸", embedded: false },
    { id: "chapter17", title: "Scratchè‡ªè¨‚æ•¸å­¸å‡½æ•¸èˆ‡ç©ºé–“é‹ç®—æ¨¡çµ„", category: "math", githubRelease: "https://github.com/chday169/scratch-web-0218/releases/download/pdfs-scratch-new/chapter17.pdf", description: "è‡ªè¨‚æ•¸å­¸å‡½æ•¸æ‡‰ç”¨", embedded: false },
    { id: "chapter18", title: "ä¸‰ç¶­ç‰¹å¾µå€¼èˆ‡ç‰¹å¾µå‘é‡æ¨¡çµ„", category: "math", githubRelease: "https://github.com/chday169/scratch-web-0218/releases/download/pdfs-scratch-new/chapter18.pdf", description: "ç·šæ€§ä»£æ•¸åœ¨Scratchä¸­çš„æ‡‰ç”¨", embedded: false },
    { id: "chapter19", title: "ä¸»æˆåˆ†åˆ†æï¼ˆPCAï¼‰èˆ‡Scratchç·¨ç¨‹æ¨¡çµ„", category: "math", githubRelease: "https://github.com/chday169/scratch-web-0218/releases/download/pdfs-scratch-new/chapter19.pdf", description: "æ•¸æ“šåˆ†ææŠ€è¡“å¯¦ç¾", embedded: false },
    { id: "chapter20", title: "ç²¾éˆç§»å‹•ä½œå¹¾ä½•é‹ç®—æ¨¡çµ„", category: "math", githubRelease: "https://github.com/chday169/scratch-web-0218/releases/download/pdfs-scratch-new/chapter20.pdf", description: "è§’è‰²é‹å‹•èˆ‡å¹¾ä½•é‹ç®—", embedded: false },
    { id: "chapter21", title: "Scratchç¬‘è‡‰ç¹ªè£½åŠçŸ©é™£è½‰æ›æ¨¡çµ„", category: "math", githubRelease: "https://github.com/chday169/scratch-web-0218/releases/download/pdfs-scratch-new/chapter21.pdf", description: "åœ–å½¢ç¹ªè£½èˆ‡çŸ©é™£è®Šæ›", embedded: false },
    { id: "chapter22", title: "Scratchæ–‡å­—è™•ç†æ¨¡çµ„", category: "advanced", githubRelease: "https://github.com/chday169/scratch-web-0218/releases/download/pdfs-scratch-new/chapter22.pdf", description: "æ–‡å­—è™•ç†èˆ‡é¡¯ç¤ºæŠ€å·§", embedded: false },
    { id: "chapter23", title: "Scratch Ã— Micro:bit æ§åˆ¶æ¨¡çµ„", category: "hardware", githubRelease: "https://github.com/chday169/scratch-web-0218/releases/download/pdfs-scratch-new/chapter23.pdf", description: "Scratchèˆ‡Micro:bitç¡¬é«”æ•´åˆ", embedded: false },
    { id: "chapter24", title: "åœ“å‘¨ç‡ã€ç©åˆ†åŠå¾®åˆ†ç°¡ä»‹", category: "math", githubRelease: "https://github.com/chday169/scratch-web-0218/releases/download/pdfs-scratch-new/chapter24.pdf", description: "å¾®ç©åˆ†æ¦‚å¿µæ•™å­¸æ‡‰ç”¨", embedded: false },
    { id: "chapter25", title: "ScratchäºŒç¶­å‡½æ•¸åœ–å½¢ç¹ªè£½æ¨¡çµ„", category: "math", githubRelease: "https://github.com/chday169/scratch-web-0218/releases/download/pdfs-scratch-new/chapter25.pdf", description: "æ•¸å­¸å‡½æ•¸åœ–å½¢ç¹ªè£½", embedded: false },
    { id: "chapter26", title: "ä¸‰ç¶­å‡½æ•¸åœ–ç¹ªè£½ç¨‹å¼è¨­è¨ˆæ¨¡çµ„åŒ–æ•´åˆç‰ˆ", category: "math", githubRelease: "https://github.com/chday169/scratch-web-0218/releases/download/pdfs-scratch-new/chapter26.pdf", description: "ä¸‰ç¶­åœ–å½¢ç¹ªè£½ç¨‹å¼è¨­è¨ˆ", embedded: false },
    { id: "chapter27", title: "å¾Scratchåˆ°Python_JavaScript Ã—_Extensionè¨­è¨ˆæ•´åˆç‰ˆ", category: "advanced", githubRelease: "https://github.com/chday169/scratch-web-0218/releases/download/pdfs-scratch-new/chapter27.pdf", description: "å¾Scratchåˆ°å…¶ä»–èªè¨€éæ¸¡", embedded: false },
    { id: "chapter28", title: "å¤šåŠŸèƒ½ç§‘å­¸è¨ˆç®—å™¨ç¿’ä½œæ¨¡çµ„ç¸½æ•´åˆ", category: "project", githubRelease: "https://github.com/chday169/scratch-web-0218/releases/download/pdfs-scratch-new/chapter28.pdf", description: "ç§‘å­¸è¨ˆç®—å™¨å®Œæ•´é–‹ç™¼", embedded: false },
    { id: "chapter29", title: "é–‹å•ŸScratchã€Œå¹¾ä½•å»ºæ§‹æ€ç¶­ã€çš„é—œéµå·¥å…·", category: "math", githubRelease: "https://github.com/chday169/scratch-web-0218/releases/download/pdfs-scratch-new/chapter29.pdf", description: "å¹¾ä½•æ€ç¶­åŸ¹é¤Šæ–¹æ³•", embedded: false },
    { id: "chapter30", title: "face-sensing(ai_python-java)", category: "ai", githubRelease: "https://github.com/chday169/scratch-web-0218/releases/download/pdfs-scratch-new/chapter30.pdf", description: "äººè‡‰è¾¨è­˜æŠ€è¡“æ‡‰ç”¨", embedded: false },
    { id: "chapter31", title: "ç›¸ç‰‡è™•ç†(ai-python-turbowarp)", category: "ai", githubRelease: "https://github.com/chday169/scratch-web-0218/releases/download/pdfs-scratch-new/chapter31.pdf", description: "åœ–åƒè™•ç†AIæ‡‰ç”¨", embedded: false },
    { id: "chapter32", title: "ä½å…ƒåœ–(ai-python-turbowarp)", category: "ai", githubRelease: "https://github.com/chday169/scratch-web-0218/releases/download/pdfs-scratch-new/chapter32.pdf", description: "ä½å…ƒåœ–è™•ç†èˆ‡AIæ•´åˆ", embedded: false }
  ];
}

// ========== æ‰€æœ‰è¼”åŠ©å‡½æ•¸ (å®Œæ•´) ==========
function loadStats() {
  const savedStats = localStorage.getItem('scratch_pdf_stats');
  if (savedStats) pdfStats = JSON.parse(savedStats);
}

function loadSavedStats() {
  pdfManifest.forEach(pdf => {
    if (pdfStats[pdf.id]) {
      pdf.views = pdfStats[pdf.id].views || 0;
    } else {
      pdf.views = 0;
    }
  });
}

function renderPDFList(filterCategory = 'all', filterType = 'all') {
  const pdfListElement = document.getElementById('pdf-list');
  if (!pdfListElement) return;
  pdfListElement.innerHTML = '';

  let filteredPDFs = pdfManifest;
  if (filterCategory !== 'all') filteredPDFs = filteredPDFs.filter(p => p.category === filterCategory);
  if (filterType === 'embedded') filteredPDFs = filteredPDFs.filter(p => p.embedded);
  if (filterType === 'download') filteredPDFs = filteredPDFs.filter(p => !p.embedded);

  if (filteredPDFs.length === 0) {
    pdfListElement.innerHTML = '<div style="grid-column:1/-1;text-align:center;padding:40px;color:#6c757d"><h3>æ²’æœ‰æ‰¾åˆ°æ•™æ</h3></div>';
    return;
  }

  filteredPDFs.forEach(pdf => {
    const pdfElement = createPDFElement(pdf);
    pdfListElement.appendChild(pdfElement);
  });
}

function createPDFElement(pdf) {
  const div = document.createElement('div');
  div.className = `pdf-item ${pdf.embedded ? 'embedded' : 'download-only'}`;
  div.dataset.id = pdf.id;
  div.innerHTML = `
    <div class="pdf-title">${pdf.title}</div>
    <div class="pdf-description">${pdf.description}</div>
    <div class="pdf-meta">
      <span class="pdf-status ${pdf.embedded ? 'embedded' : 'download'}">
        ${pdf.embedded ? 'ğŸ” é åµŒ' : 'â¬‡ï¸ ä¸‹è¼‰'}
      </span>
      <span class="pdf-views">ğŸ‘ï¸ ${pdf.views || 0} æ¬¡ç€è¦½</span>
    </div>
    <div class="pdf-actions">
      ${pdf.embedded ? `<button class="pdf-action-btn view-btn" onclick="viewPDF('${pdf.id}')">åœ¨ç·šé–±è®€</button>` : ''}
      <button class="pdf-action-btn download-btn" onclick="downloadPDF('${pdf.id}')">ä¸‹è¼‰ PDF</button>
    </div>
  `;
  return div;
}

function incrementViewCount(pdfId) {
  if (!pdfStats[pdfId]) pdfStats[pdfId] = { views: 0 };
  pdfStats[pdfId].views++;
  localStorage.setItem('scratch_pdf_stats', JSON.stringify(pdfStats));
  const pdfElement = document.querySelector(`.pdf-item[data-id="${pdfId}"] .pdf-views`);
  if (pdfElement) pdfElement.textContent = `ğŸ‘ï¸ ${pdfStats[pdfId].views} æ¬¡ç€è¦½`;
  updateCounts();
}

function updateCounts() {
  const total = pdfManifest.length;
  const embeddedCount = pdfManifest.filter(p => p.embedded).length;
  const downloadCount = total - embeddedCount;
  const totalViews = Object.values(pdfStats).reduce((sum, stat) => sum + (stat.views || 0), 0);

  const countEl = document.getElementById('pdf-count');
  const embeddedEl = document.getElementById('embedded-count');
  const downloadEl = document.getElementById('download-count');
  const viewsEl = document.getElementById('total-views');

  if (countEl) countEl.textContent = total;
  if (embeddedEl) embeddedEl.textContent = embeddedCount;
  if (downloadEl) downloadEl.textContent = downloadCount;
  if (viewsEl) viewsEl.textContent = totalViews;
}

function setupEventListeners() {
  const categoryFilter = document.getElementById('category-filter');
  const showAllBtn = document.getElementById('show-all');
  const showEmbeddedBtn = document.getElementById('show-embedded');
  const showDownloadBtn = document.getElementById('show-download');
  const closeViewerBtn = document.getElementById('close-viewer');
  const viewerOverlay = document.getElementById('pdf-viewer-overlay');

  if (categoryFilter) categoryFilter.addEventListener('change', (e) => renderPDFList(e.target.value));
  if (showAllBtn) showAllBtn.addEventListener('click', () => { renderPDFList('all'); if(categoryFilter) categoryFilter.value = 'all'; });
  if (showEmbeddedBtn) showEmbeddedBtn.addEventListener('click', () => { renderPDFList('all', 'embedded'); if(categoryFilter) categoryFilter.value = 'all'; });
  if (showDownloadBtn) showDownloadBtn.addEventListener('click', () => { renderPDFList('all', 'download'); if(categoryFilter) categoryFilter.value = 'all'; });

  if (closeViewerBtn) closeViewerBtn.addEventListener('click', hidePDFViewer);
  if (viewerOverlay) viewerOverlay.addEventListener('click', (e) => { if (e.target === viewerOverlay) hidePDFViewer(); });
}

function hidePDFViewer() {
  const viewer = document.getElementById('pdf-viewer-overlay');
  const frame = document.getElementById('pdf-viewer-frame');
  if (viewer) viewer.style.display = 'none';
  if (frame) frame.src = '';
  document.body.style.overflow = 'auto';
}

function saveStats() {
  localStorage.setItem('scratch_pdf_stats', JSON.stringify(pdfStats));
}

function recordPageView(page) {
  const key = `views_${page}`;
  let count = parseInt(localStorage.getItem(key) || '0');
  localStorage.setItem(key, (count + 1).toString());
}

function showErrorMessage(message) {
  const el = document.getElementById('pdf-list');
  if (el) el.innerHTML = `<div style="grid-column:1/-1;text-align:center;padding:40px;color:#dc3545"><h3>è¼‰å…¥å¤±æ•—</h3><p>${message}</p></div>`;
}
</script>
</body>
</html>