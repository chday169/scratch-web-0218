<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ğŸ“š Scratch æ•™æç€è¦½å™¨</title>
  <link rel="stylesheet" href="assets/style.css">
  <style>
    /* å°ˆç‚º Scratch æ•™æç€è¦½å™¨æ·»åŠ çš„æ¨£å¼ */
    .pdf-controls {
      display: flex;
      gap: 15px;
      margin: 20px 0;
      flex-wrap: wrap;
      align-items: center;
    }
    
    .filter-select {
      padding: 10px 15px;
      border: 1px solid #dee2e6;
      border-radius: 8px;
      font-size: 1rem;
      min-width: 200px;
      background: white;
    }
    
    .stats-badge {
      display: inline-block;
      padding: 5px 10px;
      background: #4a6fa5;
      color: white;
      border-radius: 20px;
      font-size: 0.9rem;
      margin-left: 10px;
    }
    
    .pdf-list-container {
      background: white;
      border-radius: 12px;
      padding: 20px;
      margin-top: 20px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.05);
    }
    
    #pdf-list {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }
    
    .pdf-item {
      background: #f8f9fa;
      border-radius: 10px;
      padding: 20px;
      border: 2px solid #e9ecef;
      cursor: pointer;
      transition: all 0.3s ease;
      position: relative;
    }
    
    .pdf-item:hover {
      border-color: #4a6fa5;
      transform: translateY(-3px);
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }
    
    .pdf-item.embedded {
      border-left: 5px solid #4a6fa5;
    }
    
    .pdf-item.download-only {
      border-left: 5px solid #28a745;
    }
    
    .pdf-title {
      font-weight: 600;
      font-size: 1.1rem;
      color: #2c3e50;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .pdf-description {
      font-size: 0.9rem;
      color: #6c757d;
      margin-bottom: 12px;
      line-height: 1.5;
    }
    
    .pdf-meta {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 10px;
    }
    
    .pdf-status {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 0.8rem;
      font-weight: 500;
    }
    
    .pdf-status.embedded {
      background: #4a6fa5;
      color: white;
    }
    
    .pdf-status.download {
      background: #28a745;
      color: white;
    }
    
    .pdf-views {
      font-size: 0.85rem;
      color: #6c757d;
    }
    
    .pdf-actions {
      display: flex;
      gap: 10px;
      margin-top: 15px;
    }
    
    .pdf-action-btn {
      flex: 1;
      padding: 8px 12px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 0.9rem;
      transition: all 0.3s ease;
    }
    
    .view-btn {
      background: #4a6fa5;
      color: white;
    }
    
    .view-btn:hover {
      background: #3a5a8c;
    }
    
    .download-btn {
      background: #28a745;
      color: white;
    }
    
    .download-btn:hover {
      background: #218838;
    }
    
    .pdf-viewer-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.8);
      z-index: 1000;
      align-items: center;
      justify-content: center;
    }
    
    .pdf-viewer-container {
      background: white;
      border-radius: 12px;
      width: 90%;
      max-width: 1000px;
      height: 90%;
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }
    
    .pdf-viewer-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px 20px;
      background: #f8f9fa;
      border-bottom: 1px solid #dee2e6;
    }
    
    .pdf-viewer-title {
      font-size: 1.2rem;
      font-weight: 600;
      color: #2c3e50;
    }
    
    .close-viewer {
      background: none;
      border: none;
      font-size: 1.5rem;
      cursor: pointer;
      color: #6c757d;
      padding: 0 10px;
    }
    
    .close-viewer:hover {
      color: #dc3545;
    }
    
    .pdf-viewer-content {
      flex: 1;
      overflow: hidden;
    }
    
    .pdf-viewer-content iframe {
      width: 100%;
      height: 100%;
      border: none;
    }
    
    .stats-cards {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-top: 30px;
    }
    
    .stat-card {
      background: white;
      border-radius: 10px;
      padding: 20px;
      text-align: center;
      box-shadow: 0 2px 10px rgba(0,0,0,0.05);
    }
    
    .stat-number {
      font-size: 2.5rem;
      font-weight: bold;
      color: #4a6fa5;
      margin: 10px 0;
    }
    
    .stat-label {
      color: #6c757d;
      font-size: 0.9rem;
    }
    
    .loading {
      text-align: center;
      padding: 40px;
      color: #6c757d;
    }
    
    .loading-spinner {
      display: inline-block;
      width: 40px;
      height: 40px;
      border: 4px solid #f3f3f3;
      border-top: 4px solid #4a6fa5;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-bottom: 15px;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    @media (max-width: 768px) {
      #pdf-list {
        grid-template-columns: 1fr;
      }
      
      .pdf-controls {
        flex-direction: column;
        align-items: stretch;
      }
      
      .filter-select {
        width: 100%;
      }
      
      .pdf-viewer-container {
        width: 95%;
        height: 95%;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <header class="page-header">
      <h1>ğŸ“š Scratch æ•™æç€è¦½å™¨</h1>
      <p class="subtitle">5å€‹é åµŒæ•™æ + 28å€‹GitHubä¸‹è¼‰è³‡æº</p>
      <a href="index.html" class="btn btn-secondary">ğŸ  è¿”å›é¦–é </a>
    </header>
    
    <nav class="breadcrumb">
      <a href="index.html">é¦–é </a> / <span>Scratch æ•™æ</span>
    </nav>
    
    <main class="main-content">
      <!-- æ§åˆ¶å€åŸŸ -->
      <div class="pdf-controls">
        <select id="category-filter" class="filter-select">
          <option value="all">ğŸ“š æ‰€æœ‰æ•™æ (33)</option>
          <option value="beginner">ğŸ‘¶ åˆå­¸è€…</option>
          <option value="setup">âš™ï¸ ç’°å¢ƒè¨­ç½®</option>
          <option value="basic">ğŸ“˜ åŸºç¤æ•™å­¸</option>
          <option value="design">ğŸ¨ è¨­è¨ˆèˆ‡ç¾è¡“</option>
          <option value="multimedia">ğŸµ å¤šåª’é«”</option>
          <option value="project">ğŸš€ å°ˆæ¡ˆå¯¦ä½œ</option>
          <option value="ai">ğŸ¤– AIæ‡‰ç”¨</option>
          <option value="creative">âœ¨ å‰µæ„è¨­è¨ˆ</option>
          <option value="math">ğŸ§® æ•¸å­¸æ‡‰ç”¨</option>
          <option value="advanced">âš¡ é€²éšæŠ€å·§</option>
          <option value="hardware">ğŸ”Œ ç¡¬é«”æ•´åˆ</option>
        </select>
        
        <div style="display: flex; gap: 10px; align-items: center;">
          <span>é¡¯ç¤º:</span>
          <button id="show-all" class="btn btn-sm">å…¨éƒ¨</button>
          <button id="show-embedded" class="btn btn-sm">é åµŒæ•™æ</button>
          <button id="show-download" class="btn btn-sm">ä¸‹è¼‰æ•™æ</button>
        </div>
      </div>
      
      <!-- PDF åˆ—è¡¨ -->
      <div class="pdf-list-container">
        <h3>ğŸ“– Scratch æ•™æåˆ—è¡¨ <span id="pdf-count" class="stats-badge">33</span></h3>
        <div id="pdf-list" class="pdf-list">
          <!-- PDF é …ç›®å°‡åœ¨é€™è£¡å‹•æ…‹ç”Ÿæˆ -->
          <div class="loading">
            <div class="loading-spinner"></div>
            <p>æ­£åœ¨è¼‰å…¥æ•™æåˆ—è¡¨...</p>
          </div>
        </div>
      </div>
      
      <!-- çµ±è¨ˆè³‡è¨Š -->
      <div class="stats-cards">
        <div class="stat-card">
          <div>ğŸ” é åµŒæ•™æ</div>
          <div class="stat-number" id="embedded-count">5</div>
          <div class="stat-label">å¯ç›´æ¥åœ¨ç·šé–±è®€</div>
        </div>
        <div class="stat-card">
          <div>â¬‡ï¸ ä¸‹è¼‰æ•™æ</div>
          <div class="stat-number" id="download-count">28</div>
          <div class="stat-label">å¾ GitHub ä¸‹è¼‰</div>
        </div>
        <div class="stat-card">
          <div>ğŸ‘ï¸ ç¸½ç€è¦½</div>
          <div class="stat-number" id="total-views">0</div>
          <div class="stat-label">æ¬¡æ•¸</div>
        </div>
      </div>
    </main>
    
    <div style="text-align: center; margin: 30px 0;">
      <a href="index.html" class="btn btn-primary">ğŸ  è¿”å›é¦–é </a>
      <a href="video-player.html?v=3.0" class="btn btn-secondary">ğŸ¥ è§€çœ‹å½±ç‰‡</a>
    </div>
  </div>
  
  <!-- PDF æŸ¥çœ‹å™¨å½ˆå‡ºå±¤ -->
  <div id="pdf-viewer-overlay" class="pdf-viewer-overlay">
    <div class="pdf-viewer-container">
      <div class="pdf-viewer-header">
        <div class="pdf-viewer-title" id="pdf-viewer-title"></div>
        <button class="close-viewer" id="close-viewer">âœ•</button>
      </div>
      <div class="pdf-viewer-content">
        <iframe id="pdf-viewer-frame" src=""></iframe>
      </div>
    </div>
  </div>
  
  <script>
    // å…¨å±€è®Šæ•¸
    let pdfManifest = [];
    let pdfStats = {};
    
    // é é¢è¼‰å…¥å®Œæˆå¾Œåˆå§‹åŒ–
    document.addEventListener('DOMContentLoaded', function() {
      // è¼‰å…¥ PDF æ¸…å–®
      loadPDFManifest();
      
      // è¨­å®šäº‹ä»¶ç›£è½å™¨
      setupEventListeners();
      
      // è¼‰å…¥çµ±è¨ˆæ•¸æ“š
      loadStats();
      
      // è¨˜éŒ„é é¢è¨ªå•
      recordPageView('scratch_viewer');
    });
    
    // è¼‰å…¥ PDF manifest
    async function loadPDFManifest() {
      try {
        console.log('æ­£åœ¨è¼‰å…¥ manifest.json...');
        
        // å˜—è©¦å¾ä¸åŒè·¯å¾‘è¼‰å…¥
        const manifestPaths = [
          './data/manifest.json',
          './data_scr/manifest.json',
          'https://chday169.github.io/scratch-web-0218/data/manifest.json'
        ];
        
        let manifest = null;
        let lastError = null;
        
        for (const path of manifestPaths) {
          try {
            const response = await fetch(path);
            if (response.ok) {
              manifest = await response.json();
              console.log(`æˆåŠŸå¾ ${path} è¼‰å…¥ manifest`);
              break;
            }
          } catch (error) {
            lastError = error;
            console.warn(`ç„¡æ³•å¾ ${path} è¼‰å…¥:`, error);
          }
        }
        
        if (!manifest) {
          // å¦‚æœæ‰€æœ‰è·¯å¾‘éƒ½å¤±æ•—ï¼Œä½¿ç”¨é è¨­æ•¸æ“š
          console.log('ä½¿ç”¨é è¨­ manifest æ•¸æ“š');
          manifest = await getDefaultManifest();
        }
        
        // å„²å­˜ manifest
        pdfManifest = manifest.pdfs || manifest;
        
        // è¼‰å…¥çµ±è¨ˆæ•¸æ“š
        loadSavedStats();
        
        // æ¸²æŸ“ PDF åˆ—è¡¨
        renderPDFList();
        
        // æ›´æ–°è¨ˆæ•¸
        updateCounts();
        
      } catch (error) {
        console.error('è¼‰å…¥ manifest å¤±æ•—:', error);
        showErrorMessage('ç„¡æ³•è¼‰å…¥æ•™æåˆ—è¡¨ï¼Œè«‹æª¢æŸ¥ç¶²è·¯é€£ç·šæˆ–ç¨å¾Œå†è©¦ã€‚');
      }
    }
    
    // å–å¾—é è¨­ manifestï¼ˆç•¶ç„¡æ³•è¼‰å…¥æª”æ¡ˆæ™‚ä½¿ç”¨ï¼‰
    async function getDefaultManifest() {
      // é€™è£¡ä½¿ç”¨æˆ‘å€‘å‰µå»ºçš„æ··åˆæ¨¡å¼ manifest çµæ§‹
      return {
        pdfs: [
          // é åµŒçš„ 5 å€‹ PDF
          {
            id: "chapter0",
            title: "Scratchå¾é›¶é–‹å§‹çš„å‰µæ„ç¨‹å¼è¨­è¨ˆä¹‹æ—…",
            type: "pdf",
            category: "beginner",
            url: "./data/pdfs/chapter00.pdf",
            githubRelease: "https://github.com/chday169/scratch-web-0218/releases/download/pdfs-scratch-new/chapter00.pdf",
            description: "Scratchå‰µæ„ç¨‹å¼è¨­è¨ˆå…¥é–€ç¯‡å°è®€",
            views: 0,
            likes: 0,
            embedded: true
          },
          {
            id: "chapter1",
            title: "Scratch3ç¨‹å¼èªè¨€ä»‹ç´¹",
            type: "pdf",
            category: "beginner",
            url: "./data/pdfs/chapter01.pdf",
            githubRelease: "https://github.com/chday169/scratch-web-0218/releases/download/pdfs-scratch-new/chapter01.pdf",
            description: "Scratch3ç¨‹å¼èªè¨€åŸºç¤ä»‹ç´¹",
            views: 0,
            likes: 0,
            embedded: true
          },
          {
            id: "chapter2",
            title: "ScratcåŠurboWarpä¸‹è¼‰ã€å®‰è£",
            type: "pdf",
            category: "setup",
            url: "./data/pdfs/chapter02.pdf",
            githubRelease: "https://github.com/chday169/scratch-web-0218/releases/download/pdfs-scratch-new/chapter02.pdf",
            description: "Scratchå’ŒTurboWarpä¸‹è¼‰å®‰è£æ•™å­¸",
            views: 0,
            likes: 0,
            embedded: true
          },
          {
            id: "chapter7",
            title: "åœ–åƒçµ„åˆ",
            type: "pdf",
            category: "design",
            url: "./data/pdfs/chapter07.pdf",
            githubRelease: "https://github.com/chday169/scratch-web-0218/releases/download/pdfs-scratch-new/chapter07.pdf",
            description: "åœ–åƒçµ„åˆèˆ‡åœ–å±¤ç®¡ç†æŠ€å·§",
            views: 0,
            likes: 0,
            embedded: true
          },
          {
            id: "chapter16",
            title: "Scratchç¹ªè£½åœ“å½¢èˆ‡æ©¢åœ“",
            type: "pdf",
            category: "math",
            url: "./data/pdfs/chapter16.pdf",
            githubRelease: "https://github.com/chday169/scratch-web-0218/releases/download/pdfs-scratch-new/chapter16.pdf",
            description: "ä½¿ç”¨Scratchç¹ªè£½å¹¾ä½•åœ–å½¢",
            views: 0,
            likes: 0,
            embedded: true
          },
          // ä»¥ä¸‹æ˜¯ 28 å€‹éœ€è¦ä¸‹è¼‰çš„ PDFï¼ˆç°¡åŒ–é¡¯ç¤ºï¼‰
          {
            id: "chapter3",
            title: "Scratch ä¸»è¦ç©æœ¨æ§‹ä»¶ä»‹ç´¹",
            type: "pdf",
            category: "basic",
            githubRelease: "https://github.com/chday169/scratch-web-0218/releases/download/pdfs-scratch-new/chapter03.pdf",
            description: "Scratchä¸»è¦ç¨‹å¼ç©æœ¨ä»‹ç´¹",
            views: 0,
            likes: 0,
            embedded: false
          },
          {
            id: "chapter4",
            title: "å»ºç«‹ Scratchï¼ˆæˆ– TurboWarpï¼‰å°ˆæ¡ˆ",
            type: "pdf",
            category: "basic",
            githubRelease: "https://github.com/chday169/scratch-web-0218/releases/download/pdfs-scratch-new/chapter04.pdf",
            description: "å»ºç«‹å’Œç®¡ç†Scratchå°ˆæ¡ˆ",
            views: 0,
            likes: 0,
            embedded: false
          },
          {
            id: "chapter5",
            title: "é€ å‹åŠèƒŒæ™¯ä¿®åœ–å·¥å…·",
            type: "pdf",
            category: "design",
            githubRelease: "https://github.com/chday169/scratch-web-0218/releases/download/pdfs-scratch-new/chapter05.pdf",
            description: "è§’è‰²é€ å‹å’ŒèƒŒæ™¯ç·¨è¼¯å·¥å…·",
            views: 0,
            likes: 0,
            embedded: false
          },
          {
            id: "chapter6",
            title: "é¡è‰²åŠé¡è‰²å¡«å……",
            type: "pdf",
            category: "design",
            githubRelease: "https://github.com/chday169/scratch-web-0218/releases/download/pdfs-scratch-new/chapter06.pdf",
            description: "Scratché¡è‰²ç³»çµ±èˆ‡å¡«å……åŠŸèƒ½",
            views: 0,
            likes: 0,
            embedded: false
          },
          {
            id: "chapter8",
            title: "èˆå°é¸å–åŠè§’è‰²é¸æ“‡",
            type: "pdf",
            category: "basic",
            githubRelease: "https://github.com/chday169/scratch-web-0218/releases/download/pdfs-scratch-new/chapter08.pdf",
            description: "èˆå°ä½ˆæ™¯èˆ‡è§’è‰²ç®¡ç†",
            views: 0,
            likes: 0,
            embedded: false
          }
          // æ³¨æ„ï¼šç‚ºäº†ç°¡åŒ–ï¼Œé€™è£¡åªé¡¯ç¤º10å€‹é …ç›®ï¼Œå¯¦éš›æ‡‰è©²æœ‰33å€‹
        ]
      };
    }
    
    // æ¸²æŸ“ PDF åˆ—è¡¨
    function renderPDFList(filterCategory = 'all', filterType = 'all') {
      const pdfListElement = document.getElementById('pdf-list');
      
      if (!pdfListElement) return;
      
      // æ¸…ç©ºåˆ—è¡¨
      pdfListElement.innerHTML = '';
      
      // éæ¿¾ PDF
      let filteredPDFs = pdfManifest;
      
      if (filterCategory !== 'all') {
        filteredPDFs = filteredPDFs.filter(pdf => pdf.category === filterCategory);
      }
      
      if (filterType === 'embedded') {
        filteredPDFs = filteredPDFs.filter(pdf => pdf.embedded === true);
      } else if (filterType === 'download') {
        filteredPDFs = filteredPDFs.filter(pdf => pdf.embedded === false);
      }
      
      // å¦‚æœæ²’æœ‰ PDF
      if (filteredPDFs.length === 0) {
        pdfListElement.innerHTML = `
          <div style="grid-column: 1 / -1; text-align: center; padding: 40px; color: #6c757d;">
            <div style="font-size: 3rem; margin-bottom: 20px;">ğŸ“š</div>
            <h3>æ²’æœ‰æ‰¾åˆ°æ•™æ</h3>
            <p>è«‹å˜—è©¦ä¸åŒçš„åˆ†é¡ç¯©é¸æ¢ä»¶</p>
          </div>
        `;
        return;
      }
      
      // å»ºç«‹æ¯å€‹ PDF é …ç›®
      filteredPDFs.forEach(pdf => {
        const pdfElement = createPDFElement(pdf);
        pdfListElement.appendChild(pdfElement);
      });
    }
    
    // å»ºç«‹ PDF å…ƒç´ 
    function createPDFElement(pdf) {
      const div = document.createElement('div');
      div.className = `pdf-item ${pdf.embedded ? 'embedded' : 'download-only'}`;
      div.dataset.id = pdf.id;
      div.dataset.category = pdf.category;
      
      // è¼‰å…¥çµ±è¨ˆæ•¸æ“š
      const stats = pdfStats[pdf.id] || { views: 0, likes: 0 };
      
      // å»ºç«‹å…§å®¹
      div.innerHTML = `
        <div class="pdf-title">
          ${pdf.title}
        </div>
        <div class="pdf-description">
          ${pdf.description || 'æš«ç„¡æè¿°'}
        </div>
        <div class="pdf-meta">
          <span class="pdf-status ${pdf.embedded ? 'embedded' : 'download'}">
            ${pdf.embedded ? 'ğŸ” é åµŒ' : 'â¬‡ï¸ ä¸‹è¼‰'}
          </span>
          <span class="pdf-views">ğŸ‘ï¸ ${stats.views} æ¬¡ç€è¦½</span>
        </div>
        <div class="pdf-actions">
          ${pdf.embedded ? `
            <button class="pdf-action-btn view-btn" onclick="viewPDF('${pdf.id}')">
              åœ¨ç·šé–±è®€
            </button>
          ` : ''}
          ${pdf.githubRelease ? `
            <button class="pdf-action-btn download-btn" onclick="downloadPDF('${pdf.id}')">
              ä¸‹è¼‰ PDF
            </button>
          ` : ''}
        </div>
      `;
      
      return div;
    }
    
    // æŸ¥çœ‹ PDFï¼ˆé åµŒï¼‰
    function viewPDF(pdfId) {
      const pdf = pdfManifest.find(p => p.id === pdfId);
      if (!pdf || !pdf.embedded) return;
      
      // å¢åŠ ç€è¦½è¨ˆæ•¸
      incrementViewCount(pdfId);
      
      // é¡¯ç¤º PDF æŸ¥çœ‹å™¨
      const viewerOverlay = document.getElementById('pdf-viewer-overlay');
      const viewerTitle = document.getElementById('pdf-viewer-title');
      const viewerFrame = document.getElementById('pdf-viewer-frame');
      
      viewerTitle.textContent = pdf.title;
      
      // è¨­å®š PDF ä¾†æº
      // å…ˆå˜—è©¦æœ¬åœ°è·¯å¾‘ï¼Œå¦‚æœå¤±æ•—å‰‡ä½¿ç”¨ GitHub Release é€£çµ
      const pdfUrl = pdf.url || pdf.githubRelease;
      viewerFrame.src = pdfUrl;
      
      // é¡¯ç¤ºæŸ¥çœ‹å™¨
      viewerOverlay.style.display = 'flex';
      
      // é˜»æ­¢èƒŒæ™¯æ»¾å‹•
      document.body.style.overflow = 'hidden';
    }
    
    // ä¸‹è¼‰ PDF
    function downloadPDF(pdfId) {
      const pdf = pdfManifest.find(p => p.id === pdfId);
      if (!pdf || !pdf.githubRelease) return;
      
      // å¢åŠ ç€è¦½è¨ˆæ•¸
      incrementViewCount(pdfId);
      
      // åœ¨æ–°åˆ†é ä¸­é–‹å•Ÿä¸‹è¼‰é€£çµ
      window.open(pdf.githubRelease, '_blank');
    }
    
    // å¢åŠ ç€è¦½è¨ˆæ•¸
    function incrementViewCount(pdfId) {
      if (!pdfStats[pdfId]) {
        pdfStats[pdfId] = { views: 0, likes: 0 };
      }
      
      pdfStats[pdfId].views++;
      saveStats();
      updateCounts();
      
      // æ›´æ–° UI
      const pdfElement = document.querySelector(`.pdf-item[data-id="${pdfId}"] .pdf-views`);
      if (pdfElement) {
        pdfElement.textContent = `ğŸ‘ï¸ ${pdfStats[pdfId].views} æ¬¡ç€è¦½`;
      }
    }
    
    // æ›´æ–°è¨ˆæ•¸é¡¯ç¤º
    function updateCounts() {
      // æ›´æ–°ç¸½æ•¸
      document.getElementById('pdf-count').textContent = pdfManifest.length;
      
      // è¨ˆç®—é åµŒå’Œä¸‹è¼‰æ•¸é‡
      const embeddedCount = pdfManifest.filter(pdf => pdf.embedded).length;
      const downloadCount = pdfManifest.length - embeddedCount;
      
      document.getElementById('embedded-count').textContent = embeddedCount;
      document.getElementById('download-count').textContent = downloadCount;
      
      // è¨ˆç®—ç¸½ç€è¦½æ¬¡æ•¸
      const totalViews = Object.values(pdfStats).reduce((sum, stat) => sum + (stat.views || 0), 0);
      document.getElementById('total-views').textContent = totalViews;
    }
    
    // è¨­å®šäº‹ä»¶ç›£è½å™¨
    function setupEventListeners() {
      // åˆ†é¡ç¯©é¸
      const categoryFilter = document.getElementById('category-filter');
      if (categoryFilter) {
        categoryFilter.addEventListener('change', function() {
          renderPDFList(this.value);
        });
      }
      
      // é¡¯ç¤ºå…¨éƒ¨
      const showAllBtn = document.getElementById('show-all');
      if (showAllBtn) {
        showAllBtn.addEventListener('click', function() {
          renderPDFList('all');
          categoryFilter.value = 'all';
        });
      }
      
      // é¡¯ç¤ºé åµŒ
      const showEmbeddedBtn = document.getElementById('show-embedded');
      if (showEmbeddedBtn) {
        showEmbeddedBtn.addEventListener('click', function() {
          renderPDFList('all', 'embedded');
          categoryFilter.value = 'all';
        });
      }
      
      // é¡¯ç¤ºä¸‹è¼‰
      const showDownloadBtn = document.getElementById('show-download');
      if (showDownloadBtn) {
        showDownloadBtn.addEventListener('click', function() {
          renderPDFList('all', 'download');
          categoryFilter.value = 'all';
        });
      }
      
      // é—œé–‰ PDF æŸ¥çœ‹å™¨
      const closeViewerBtn = document.getElementById('close-viewer');
      if (closeViewerBtn) {
        closeViewerBtn.addEventListener('click', function() {
          const viewerOverlay = document.getElementById('pdf-viewer-overlay');
          const viewerFrame = document.getElementById('pdf-viewer-frame');
          
          viewerOverlay.style.display = 'none';
          viewerFrame.src = '';
          
          // æ¢å¾©èƒŒæ™¯æ»¾å‹•
          document.body.style.overflow = 'auto';
        });
      }
      
      // é»æ“ŠèƒŒæ™¯é—œé–‰æŸ¥çœ‹å™¨
      const viewerOverlay = document.getElementById('pdf-viewer-overlay');
      if (viewerOverlay) {
        viewerOverlay.addEventListener('click', function(e) {
          if (e.target === this) {
            const viewerFrame = document.getElementById('pdf-viewer-frame');
            
            this.style.display = 'none';
            viewerFrame.src = '';
            
            // æ¢å¾©èƒŒæ™¯æ»¾å‹•
            document.body.style.overflow = 'auto';
          }
        });
      }
    }
    
    // è¼‰å…¥çµ±è¨ˆæ•¸æ“š
    function loadStats() {
      // å˜—è©¦å¾ localStorage è¼‰å…¥
      const savedStats = localStorage.getItem('scratch_pdf_stats');
      if (savedStats) {
        pdfStats = JSON.parse(savedStats);
      }
    }
    
    // è¼‰å…¥ä¿å­˜çš„çµ±è¨ˆæ•¸æ“šåˆ° manifest
    function loadSavedStats() {
      pdfManifest.forEach(pdf => {
        if (pdfStats[pdf.id]) {
          pdf.views = pdfStats[pdf.id].views;
          pdf.likes = pdfStats[pdf.id].likes;
        }
      });
    }
    
    // ä¿å­˜çµ±è¨ˆæ•¸æ“š
    function saveStats() {
      localStorage.setItem('scratch_pdf_stats', JSON.stringify(pdfStats));
    }
    
    // è¨˜éŒ„é é¢è¨ªå•
    function recordPageView(page) {
      const key = `views_${page}`;
      let count = parseInt(localStorage.getItem(key) || '0');
      count++;
      localStorage.setItem(key, count.toString());
    }
    
    // é¡¯ç¤ºéŒ¯èª¤è¨Šæ¯
    function showErrorMessage(message) {
      const pdfListElement = document.getElementById('pdf-list');
      if (pdfListElement) {
        pdfListElement.innerHTML = `
          <div style="grid-column: 1 / -1; text-align: center; padding: 40px; color: #dc3545;">
            <div style="font-size: 3rem; margin-bottom: 20px;">âš ï¸</div>
            <h3>è¼‰å…¥å¤±æ•—</h3>
            <p>${message}</p>
            <button onclick="loadPDFManifest()" class="btn btn-primary" style="margin-top: 20px;">
              é‡è©¦è¼‰å…¥
            </button>
          </div>
        `;
      }
    }
    
    // æä¾›å…¨å±€å‡½æ•¸ä¾›æŒ‰éˆ•ä½¿ç”¨
    window.viewPDF = viewPDF;
    window.downloadPDF = downloadPDF;
    window.loadPDFManifest = loadPDFManifest;
  </script>
</body>
</html>